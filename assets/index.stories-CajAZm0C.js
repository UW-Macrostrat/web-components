import{m as ie}from"./index.modern-CqpcyjV2.js";import{r as K}from"./index-BBkUAzwr.js";import"./index-DtBkkNk_.js";var re={exports:{}};(function(W,X){(function(O,B){W.exports=B()})(window,function(){return M={},O.m=B=[function(E,f,v){Object.defineProperty(f,"__esModule",{value:!0}),f.SVGNS="http://www.w3.org/2000/svg"},function(E,f,v){var x,b=this&&this.__extends||(x=function(a,o){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r])})(a,o)},function(a,o){function n(){this.constructor=a}x(a,o),a.prototype=o===null?Object.create(o):(n.prototype=o.prototype,new n)}),y=this&&this.__values||function(a){var o=typeof Symbol=="function"&&Symbol.iterator,n=o&&a[o],t=0;if(n)return n.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&t>=a.length&&(a=void 0),{value:a&&a[t++],done:!a}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(f,"__esModule",{value:!0});var g,d,m,h=v(4),u=v(3);function l(){var a=d!==null&&d.apply(this,arguments)||this;return a.entities=new Map,a.nextId=0,a}g=f.Base||(f.Base={}),d=u.EventEmitter,b(l,d),Object.defineProperty(l.prototype,"json",{get:function(){var a,o,n=[];try{for(var t=y(this.values()),r=t.next();!r.done;r=t.next()){var e=r.value;"json"in e?n.push(e.json):n.push(JSON.parse(JSON.stringify(e)))}}catch(i){a={error:i}}finally{try{r&&!r.done&&(o=t.return)&&o.call(t)}finally{if(a)throw a.error}}return n},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"length",{get:function(){return this.entities.size},enumerable:!0,configurable:!0}),l.prototype.get=function(a){return h.assert(this.has(a),"There's no Entity which id="+a+" in repo!"),this.entities.get(a)},l.prototype.has=function(a){return this.entities.has(a)},l.prototype.set=function(a,o){var n=this.has(a);return this.entities.set(a,o),n?this.emit("updated",o):(this.nextId<a+1&&(this.nextId=a+1),this.emit("created",o)),this},l.prototype.add=function(a){if("id"in a){var o=a.id;return h.assert(!this.has(o),"reAdd "+o+"!"),o===null?(a.id=this.nextId,this.add(a)):(this.set(o,a),o)}var n=this.nextId;return this.set(n,a),n},l.prototype[Symbol.iterator]=function(){return this.entities[Symbol.iterator]()},l.prototype.delete=function(a){if(typeof a=="number"&&this.has(a)){var o=this.get(a);return this.entities.delete(a),this.emit("removed",o),!0}return typeof a!="number"&&"id"in a&&this.delete(a.id)},l.prototype.values=function(){return this.entities.values()},m=l,g.Repository=m},function(E,f,v){Object.defineProperty(f,"__esModule",{value:!0});var x=(Object.defineProperty(b.prototype,"isSome",{get:function(){return this.value!==null},enumerable:!0,configurable:!0}),b.prototype.map=function(d){return this.value===null?new b(null):new b(d(this.value))},b.prototype.flatMap=function(d){return this.value===null?new b(null):g(d(this.value).toNullable())},b.prototype.orElse=function(d){return this.value===null?d:this.value},b.prototype.toNullable=function(){return this.value},b.prototype.match=function(d,m){return this.isSome?d:m},b);function b(d){this.value=d}function y(d){return new x(d)}function g(d){return d==null?f.none:y(d)}f.Option=x,f.none=new x(null),f.some=y,f.fromNullable=g,f.fromTry=function(d){try{return y(d())}catch{return f.none}}},function(E,f,v){var x,b=typeof Reflect=="object"?Reflect:null,y=b&&typeof b.apply=="function"?b.apply:function(t,r,e){return Function.prototype.apply.call(t,r,e)};x=b&&typeof b.ownKeys=="function"?b.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var g=Number.isNaN||function(t){return t!=t};function d(){d.init.call(this)}((E.exports=d).EventEmitter=d).prototype._events=void 0,d.prototype._eventsCount=0,d.prototype._maxListeners=void 0;var m=10;function h(t){return t._maxListeners===void 0?d.defaultMaxListeners:t._maxListeners}function u(t,r,e,i){var s,c,p;if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);if((c=t._events)===void 0?(c=t._events=Object.create(null),t._eventsCount=0):(c.newListener!==void 0&&(t.emit("newListener",r,e.listener?e.listener:e),c=t._events),p=c[r]),p===void 0)p=c[r]=e,++t._eventsCount;else if(typeof p=="function"?p=c[r]=i?[e,p]:[p,e]:i?p.unshift(e):p.push(e),0<(s=h(t))&&p.length>s&&!p.warned){p.warned=!0;var w=new Error("Possible EventEmitter memory leak detected. "+p.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit");w.name="MaxListenersExceededWarning",w.emitter=t,w.type=r,w.count=p.length,function(I){console&&console.warn&&console.warn(I)}(w)}return t}function l(t,r,e){var i={fired:!1,wrapFn:void 0,target:t,type:r,listener:e},s=(function(){for(var c=[],p=0;p<arguments.length;p++)c.push(arguments[p]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,y(this.listener,this.target,c))}).bind(i);return s.listener=e,i.wrapFn=s}function a(t,r,e){var i=t._events;if(i===void 0)return[];var s=i[r];return s===void 0?[]:typeof s=="function"?e?[s.listener||s]:[s]:e?function(c){for(var p=new Array(c.length),w=0;w<p.length;++w)p[w]=c[w].listener||c[w];return p}(s):n(s,s.length)}function o(t){var r=this._events;if(r!==void 0){var e=r[t];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}function n(t,r){for(var e=new Array(r),i=0;i<r;++i)e[i]=t[i];return e}Object.defineProperty(d,"defaultMaxListeners",{enumerable:!0,get:function(){return m},set:function(t){if(typeof t!="number"||t<0||g(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");m=t}}),d.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},d.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||g(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},d.prototype.getMaxListeners=function(){return h(this)},d.prototype.emit=function(t){for(var r=[],e=1;e<arguments.length;e++)r.push(arguments[e]);var i=t==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var c;if(0<r.length&&(c=r[0]),c instanceof Error)throw c;var p=new Error("Unhandled error."+(c?" ("+c.message+")":""));throw p.context=c,p}var w=s[t];if(w===void 0)return!1;if(typeof w=="function")y(w,this,r);else{var I=w.length,L=n(w,I);for(e=0;e<I;++e)y(L[e],this,r)}return!0},d.prototype.on=d.prototype.addListener=function(t,r){return u(this,t,r,!1)},d.prototype.prependListener=function(t,r){return u(this,t,r,!0)},d.prototype.once=function(t,r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r);return this.on(t,l(this,t,r)),this},d.prototype.prependOnceListener=function(t,r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r);return this.prependListener(t,l(this,t,r)),this},d.prototype.off=d.prototype.removeListener=function(t,r){var e,i,s,c,p;if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r);if((i=this._events)===void 0)return this;if((e=i[t])===void 0)return this;if(e===r||e.listener===r)--this._eventsCount==0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,e.listener||r));else if(typeof e!="function"){for(s=-1,c=e.length-1;0<=c;c--)if(e[c]===r||e[c].listener===r){p=e[c].listener,s=c;break}if(s<0)return this;s===0?e.shift():function(w,I){for(;I+1<w.length;I++)w[I]=w[I+1];w.pop()}(e,s),e.length===1&&(i[t]=e[0]),i.removeListener!==void 0&&this.emit("removeListener",t,p||r)}return this},d.prototype.removeAllListeners=function(t){var r,e,i;if((e=this._events)===void 0)return this;if(e.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):e[t]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete e[t]),this;if(arguments.length===0){var s,c=Object.keys(e);for(i=0;i<c.length;++i)(s=c[i])!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(r=e[t])=="function")this.removeListener(t,r);else if(r!==void 0)for(i=r.length-1;0<=i;i--)this.removeListener(t,r[i]);return this},d.prototype.listeners=function(t){return a(this,t,!0)},d.prototype.rawListeners=function(t){return a(this,t,!1)},d.listenerCount=function(t,r){return typeof t.listenerCount=="function"?t.listenerCount(r):o.call(t,r)},d.prototype.listenerCount=o,d.prototype.eventNames=function(){return 0<this._eventsCount?x(this._events):[]}},function(E,f,v){Object.defineProperty(f,"__esModule",{value:!0}),f.assert=function(x,b){}},function(E,f,v){Object.defineProperty(f,"__esModule",{value:!0}),f.shadeColor=function(x,b){var y=parseInt(x.slice(1),16),g=Math.min((y>>16)+(y>>16)*b/100,255),d=Math.min((y>>8&255)+(y>>8&255)*b/100,255);return"#"+(Math.min((255&y)+(255&y)*b/100,255)|d<<8|g<<16).toString(16)},f.addAlpha=function(x,b){var y=parseInt(x.slice(1),16);return"rgba("+(y>>16)+","+(y>>8&255)+","+(255&y)+","+b+"%)"}},function(E,f,v){Object.defineProperty(f,"__esModule",{value:!0});function x(){this.layer=0}f.TopContextUser=x,f.overLaps=function b(y,g){return y.layer===g.layer&&(y.left>g.left?b(g,y):!(y.left+y.width<g.left))}},function(E,f,v){var x,b=this&&this.__extends||(x=function(l,a){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,n){o.__proto__=n}||function(o,n){for(var t in n)n.hasOwnProperty(t)&&(o[t]=n[t])})(l,a)},function(l,a){function o(){this.constructor=l}x(l,a),l.prototype=a===null?Object.create(a):(o.prototype=a.prototype,new o)}),y=this&&this.__read||function(l,a){var o=typeof Symbol=="function"&&l[Symbol.iterator];if(!o)return l;var n,t,r=o.call(l),e=[];try{for(;(a===void 0||0<a--)&&!(n=r.next()).done;)e.push(n.value)}catch(i){t={error:i}}finally{try{n&&!n.done&&(o=r.return)&&o.call(r)}finally{if(t)throw t.error}}return e},g=this&&this.__spread||function(){for(var l=[],a=0;a<arguments.length;a++)l=l.concat(y(arguments[a]));return l};Object.defineProperty(f,"__esModule",{value:!0});var d=v(6),m=v(0),h=v(1),u=v(5);(function(l){var a,o=(a=d.TopContextUser,b(n,a),Object.defineProperty(n.prototype,"id",{get:function(){return this.store.id},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lineIn",{get:function(){return this.contextIn.belongTo},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"view",{get:function(){return this.lineIn.view},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"highLightWidth",{get:function(){return this.view.contentWidth(this.store.startIndex,this.store.endIndex)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"highLightLeft",{get:function(){return this.view.contentWidth(this.lineIn.startIndex,this.store.startIndex)+this.lineIn.view.paddingLeft},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"middle",{get:function(){return this.highLightLeft+this.highLightWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"labelLeft",{get:function(){return this.middle-this.labelWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"labelRight",{get:function(){return this.middle+this.labelWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"labelWidth",{get:function(){return this.view.labelFont.widthOf(this.store.category.text)+this.config.labelPadding+2},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.config.labelWidthCalcMethod==="max"?this.labelWidth>this.highLightWidth?this.labelLeft:this.highLightLeft:this.labelLeft},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this.config.labelWidthCalcMethod==="max"?this.labelWidth>this.highLightWidth-1?this.labelWidth:this.highLightWidth-1:this.labelWidth},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"annotationY",{get:function(){return-this.view.topContextLayerHeight*(this.layer-1)-(this.view.labelFont.lineHeight+2+2*this.config.labelPadding+this.config.bracketWidth)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"globalY",{get:function(){return this.lineIn.y+this.annotationY},enumerable:!0,configurable:!0}),n.prototype.render=function(){var i;this.svgElement=document.createElementNS(m.SVGNS,"g"),(i=this.svgElement.classList).add.apply(i,g(this.config.labelClasses));var s=this.createHighLightElement(),c=this.createAnnotationElement(),p=this.view.topContextLayerHeight*(this.layer-1),w=this.createBracketElement(this.highLightWidth,-p,0,-p,this.config.bracketWidth);return this.svgElement.appendChild(s),this.svgElement.appendChild(c),this.svgElement.appendChild(w),this.svgElement},n.prototype.update=function(){this.svgElement.style.transform="translate("+this.highLightLeft+"px,"+this.lineIn.y+"px)"},n.prototype.remove=function(){this.svgElement.remove()},n.prototype.createHighLightElement=function(){var i=document.createElementNS(m.SVGNS,"rect"),s=this.store.category.color;return i.setAttribute("height",this.lineIn.view.contentFont.lineHeight.toString()),i.setAttribute("width",this.highLightWidth.toString()),i.setAttribute("fill",/^#/g.test(s)?u.addAlpha(s,70):s),i},n.prototype.createBracketElement=function(i,s,c,p,w,I){I===void 0&&(I=.6);var L=i-c,C=s-p,_=Math.sqrt(L*L+C*C),A=i+I*w*(C/=_),R=s-I*w*(L/=_),P=i-.25*_*L+(1-I)*w*C,S=s-.25*_*C-(1-I)*w*L,H=i-.5*_*L+w*C,G=s-.5*_*C-w*L,F=c+I*w*C,k=p-I*w*L,U=i-.75*_*L+(1-I)*w*C,J=s-.75*_*C-(1-I)*w*L,V=document.createElementNS(m.SVGNS,"path");return V.setAttribute("d","M"+i+","+s+"Q"+A+","+R+","+P+","+S+"T"+H+","+G+"M"+c+","+p+"Q"+F+","+k+","+U+","+J+"T"+H+","+G),V.setAttribute("fill","none"),V.setAttribute("stroke",this.store.category.borderColor),V},n.prototype.createAnnotationElement=function(){var i=this,s=this.view.labelCategoryElementFactoryRepository.get(this.store.category.id).create();return s.style.transform="translate("+(this.highLightWidth-this.labelWidth)/2+"px,"+this.annotationY+"px)",s.onclick=function(c){i.view.root.emit("labelClicked",i.id,c)},s.ondblclick=function(c){i.view.root.emit("labelDoubleClicked",i.id,c)},s.oncontextmenu=function(c){i.view.root.emit("labelRightClicked",i.id,c),c.preventDefault()},s.onmouseenter=function(){i.svgElement.classList.add("hover"),Array.from(i.store.connectionsFrom).map(function(c){return i.view.connectionViewRepository.get(c.id)}).map(function(c){return c.addHover("from")}),Array.from(i.store.connectionsTo).map(function(c){return i.view.connectionViewRepository.get(c.id)}).map(function(c){return c.addHover("to")})},s.onmouseleave=function(){i.svgElement.classList.remove("hover"),Array.from(i.store.connectionsFrom).map(function(c){return i.view.connectionViewRepository.get(c.id)}).map(function(c){return c.removeHover("from")}),Array.from(i.store.connectionsTo).map(function(c){return i.view.connectionViewRepository.get(c.id)}).map(function(c){return c.removeHover("to")})},s},n);function n(i,s,c){var p=a.call(this)||this;return p.store=i,p.contextIn=s,p.config=c,p.layer=0,p.svgElement=null,p}l.Entity=o;var t,r=(t=h.Base.Repository,b(e,t),e.prototype.get=function(i){return this.entities.get(i)},e);function e(){return t!==null&&t.apply(this,arguments)||this}l.Repository=r})(f.LabelView||(f.LabelView={}))},function(E,f,v){var x,b=this&&this.__extends||(x=function(d,m){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,u){h.__proto__=u}||function(h,u){for(var l in u)u.hasOwnProperty(l)&&(h[l]=u[l])})(d,m)},function(d,m){function h(){this.constructor=d}x(d,m),d.prototype=m===null?Object.create(m):(h.prototype=m.prototype,new h)}),y=this&&this.__values||function(d){var m=typeof Symbol=="function"&&Symbol.iterator,h=m&&d[m],u=0;if(h)return h.call(d);if(d&&typeof d.length=="number")return{next:function(){return d&&u>=d.length&&(d=void 0),{value:d&&d[u++],done:!d}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(f,"__esModule",{value:!0});var g=v(1);(function(d){var m=(Object.defineProperty(h.prototype,"startIndex",{get:function(){return this._startIndex},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"endIndex",{get:function(){return this._endIndex},enumerable:!0,configurable:!0}),h.prototype.move=function(t){this._startIndex+=t,this._endIndex+=t},Object.defineProperty(h.prototype,"category",{get:function(){return this.root.labelCategoryRepo.get(this.categoryId)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"json",{get:function(){return{id:this.id,categoryId:this.categoryId,startIndex:this.startIndex,endIndex:this.endIndex}},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"sameLineConnections",{get:function(){var t,r,e=[];try{for(var i=y(this.root.connectionRepo.values()),s=i.next();!s.done;s=i.next()){var c=s.value;c.priorLabel===this&&e.push(c)}}catch(p){t={error:p}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return e},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"connectionsFrom",{get:function(){var t,r,e=new Set;try{for(var i=y(this.root.connectionRepo.values()),s=i.next();!s.done;s=i.next()){var c=s.value;c.from===this&&e.add(c)}}catch(p){t={error:p}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return e},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"connectionsTo",{get:function(){var t,r,e=new Set;try{for(var i=y(this.root.connectionRepo.values()),s=i.next();!s.done;s=i.next()){var c=s.value;c.to===this&&e.add(c)}}catch(p){t={error:p}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return e},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"allConnections",{get:function(){return new Set(Array.prototype.concat(Array.from(this.connectionsFrom),Array.from(this.connectionsTo)))},enumerable:!0,configurable:!0}),h);function h(t,r,e,i,s){this.id=t,this.categoryId=r,this._startIndex=e,this._endIndex=i,this.root=s}d.Entity=m;var u,l,a=(u=g.Base.Repository,b(o,u),o.prototype.set=function(t,r){return this.againstMultipleLabelWith(r)?console.warn("try set a label against the againstMultipleLabelWith rule!"):u.prototype.set.call(this,t,r),this},o.prototype.add=function(t){return this.againstMultipleLabelWith(t)?(console.warn("try add a label against the againstMultipleLabelWith rule!"),-1):u.prototype.add.call(this,t)},o.prototype.againstMultipleLabelWith=function(t){function r(i,s){return i.startIndex===s.startIndex&&i.endIndex===s.endIndex}var e=this.config.allowMultipleLabel==="notAllowed"?r:function(i,s){return r(i,s)&&i.categoryId==s.categoryId};return Array.from(this.values()).some(function(i){return e(i,t)})},o.prototype.getEntitiesInRange=function(t,r){return Array.from(this.entities.values()).filter(function(e){return t<=e.startIndex&&e.endIndex<=r})},o.prototype.getEntitiesCross=function(t){return Array.from(this.entities.values()).filter(function(r){return r.startIndex<=t&&t<r.endIndex})},o);function o(t){var r=u.call(this)||this;return r.config=t,r}function n(t,r){return new m(t.id,t.categoryId,t.startIndex,t.endIndex,r)}d.Repository=a,(l=d.Factory||(d.Factory={})).create=n,l.createAll=function(t,r){return t.map(function(e){return n(e,r)})}})(f.Label||(f.Label={}))},function(E,f,v){var x,b=this&&this.__extends||(x=function(g,d){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,h){m.__proto__=h}||function(m,h){for(var u in h)h.hasOwnProperty(u)&&(m[u]=h[u])})(g,d)},function(g,d){function m(){this.constructor=g}x(g,d),g.prototype=d===null?Object.create(d):(m.prototype=d.prototype,new m)});Object.defineProperty(f,"__esModule",{value:!0});var y=v(1);(function(g){var d=(Object.defineProperty(m.prototype,"category",{get:function(){return this.root.connectionCategoryRepo.get(this.categoryId)},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"from",{get:function(){return this.root.labelRepo.get(this.fromId)},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"to",{get:function(){return this.root.labelRepo.get(this.toId)},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"priorLabel",{get:function(){return this.from.startIndex<this.to.startIndex?this.from:this.to},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"posteriorLabel",{get:function(){return this.from.startIndex>=this.to.startIndex?this.from:this.to},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"json",{get:function(){return{id:this.id,categoryId:this.categoryId,fromId:this.fromId,toId:this.toId}},enumerable:!0,configurable:!0}),m);function m(n,t,r,e,i){this.id=n,this.categoryId=t,this.fromId=r,this.toId=e,this.root=i}g.Entity=d;var h,u,l=(h=y.Base.Repository,b(a,h),a.prototype.set=function(n,t){return this.againstMultipleConnectionRuleWith(t)?console.warn("try set a label against the checkMultipleLabel rule!"):h.prototype.set.call(this,n,t),this},a.prototype.add=function(n){return this.againstMultipleConnectionRuleWith(n)?(console.warn("try add a label against the checkMultipleLabel rule!"),-1):h.prototype.add.call(this,n)},a.prototype.againstMultipleConnectionRuleWith=function(n){function t(e,i){return e.from===i.from&&e.to===i.to}var r=this.config.allowMultipleConnection==="notAllowed"?t:function(e,i){return t(e,i)&&e.categoryId==i.categoryId};return Array.from(this.values()).some(function(e){return r(e,n)})},a);function a(n){var t=h.call(this)||this;return t.config=n,t}function o(n,t){return new d(n.id,n.categoryId,n.fromId,n.toId,t)}g.Repository=l,(u=g.Factory||(g.Factory={})).create=o,u.createAll=function(n,t){return n.map(function(r){return o(r,t)})}})(f.Connection||(f.Connection={}))},function(E,f,v){var x,b=this&&this.__extends||(x=function(u,l){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,o){a.__proto__=o}||function(a,o){for(var n in o)o.hasOwnProperty(n)&&(a[n]=o[n])})(u,l)},function(u,l){function a(){this.constructor=u}x(u,l),u.prototype=l===null?Object.create(l):(a.prototype=l.prototype,new a)}),y=this&&this.__read||function(u,l){var a=typeof Symbol=="function"&&u[Symbol.iterator];if(!a)return u;var o,n,t=a.call(u),r=[];try{for(;(l===void 0||0<l--)&&!(o=t.next()).done;)r.push(o.value)}catch(e){n={error:e}}finally{try{o&&!o.done&&(a=t.return)&&a.call(t)}finally{if(n)throw n.error}}return r},g=this&&this.__spread||function(){for(var u=[],l=0;l<arguments.length;l++)u=u.concat(y(arguments[l]));return u};Object.defineProperty(f,"__esModule",{value:!0});var d=v(1),m=v(0),h=v(6);(function(u){var l,a=(l=h.TopContextUser,b(o,l),Object.defineProperty(o.prototype,"id",{get:function(){return this.store.id},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"lineIn",{get:function(){return this.contextIn.belongTo},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"view",{get:function(){return this.lineIn.view},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"sameLineLabelView",{get:function(){return this.view.labelViewRepository.get(this.store.priorLabel.id)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"mayNotSameLineLabelView",{get:function(){return this.view.labelViewRepository.get(this.store.posteriorLabel.id)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"fromLabelView",{get:function(){return this.view.labelViewRepository.get(this.store.from.id)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"toLabelView",{get:function(){return this.view.labelViewRepository.get(this.store.to.id)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"leftLabelView",{get:function(){return this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.fromLabelView:this.toLabelView},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"rightLabelView",{get:function(){return this.fromLabelView.labelLeft>=this.toLabelView.labelLeft?this.fromLabelView:this.toLabelView},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"middle",{get:function(){return(this.leftLabelView.labelLeft+this.rightLabelView.labelRight)/2},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"textWidth",{get:function(){return this.view.connectionFont.widthOf(this.store.category.text)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"textLeft",{get:function(){return this.middle-this.textWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"lineIncludedWidth",{get:function(){return this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.toLabelView.labelRight-this.fromLabelView.labelLeft:this.fromLabelView.labelRight-this.toLabelView.labelLeft},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"lineIncludedLeft",{get:function(){return this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.fromLabelView.labelLeft:this.toLabelView.labelLeft},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"width",{get:function(){return this.config.connectionWidthCalcMethod==="text"?this.textWidth:this.lineIncludedWidth},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"left",{get:function(){return this.config.connectionWidthCalcMethod==="text"?this.textLeft:this.lineIncludedLeft},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"globalY",{get:function(){return this.lineIn.y-this.layer*this.view.topContextLayerHeight},enumerable:!0,configurable:!0}),o.prototype.render=function(){var e=this;this.svgElement=document.createElementNS(m.SVGNS,"g");var i=this.view.connectionCategoryElementFactoryRepository.get(this.store.category.id).create();return this.svgElement.appendChild(i),this.svgElement.style.cursor="pointer",this.svgElement.onclick=function(s){e.view.root.emit("connectionClicked",e.id,s)},this.svgElement.ondblclick=function(s){e.view.root.emit("connectionDoubleClicked",e.id,s)},this.svgElement.oncontextmenu=function(s){e.view.root.emit("connectionRightClicked",e.id,s),s.preventDefault()},this.svgElement.onmouseenter=function(){e.svgElement.classList.add("hover"),e.lineElement.classList.add("hover")},this.svgElement.onmouseleave=function(){e.svgElement.classList.remove("hover"),e.lineElement.classList.remove("hover")},this.renderLine(),this.svgElement},o.prototype.update=function(){this.svgElement.style.transform="translate("+this.textLeft+"px,"+this.globalY+"px)",this.updateLine()},o.prototype.addHover=function(e){this.svgElement.classList.add("hover-"+e),this.lineElement.classList.add("hover-"+e)},o.prototype.removeHover=function(e){this.svgElement.classList.remove("hover-"+e),this.lineElement.classList.remove("hover-"+e)},o.prototype.remove=function(){this.svgElement.remove(),this.lineElement.remove()},o.prototype.updateLine=function(){var e=this.globalY+this.view.topContextLayerHeight/2-this.view.labelFont.fontSize+2;this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.lineElement.setAttribute("d",`
                    M `+(this.fromLabelView.labelLeft+1)+"   "+(this.fromLabelView.globalY+1)+`
                    C `+(this.fromLabelView.labelLeft-8)+"  "+e+`,
                      `+(this.fromLabelView.labelLeft-8)+"  "+e+`,
                      `+(this.fromLabelView.labelLeft+1)+"   "+e+`
                    L `+(this.toLabelView.labelLeft+this.toLabelView.labelWidth)+" "+e+`
                    C `+(this.toLabelView.labelLeft+this.toLabelView.labelWidth+8)+"  "+e+`,
                      `+(this.toLabelView.labelLeft+this.toLabelView.labelWidth+8)+"  "+e+`,
                      `+(this.toLabelView.labelLeft+this.toLabelView.labelWidth)+"   "+(this.toLabelView.globalY-1)+`
                `):this.lineElement.setAttribute("d",`
                    M `+(this.fromLabelView.labelRight-1)+"   "+(this.fromLabelView.globalY+1)+`
                    C `+(this.fromLabelView.labelRight+8)+"  "+e+`,
                      `+(this.fromLabelView.labelRight+8)+"  "+e+`,
                      `+(this.fromLabelView.labelRight-1)+"   "+e+`
                    L `+this.toLabelView.labelLeft+"          "+e+`
                    C `+(this.toLabelView.labelLeft-8)+"  "+e+`,
                      `+(this.toLabelView.labelLeft-8)+"  "+e+`,
                      `+this.toLabelView.labelLeft+"   "+(this.toLabelView.globalY-1)+`
                `)},o.prototype.renderLine=function(){var e;this.lineElement=document.createElementNS(m.SVGNS,"path"),(e=this.lineElement.classList).add.apply(e,g(this.config.connectionClasses.map(function(i){return i+"-line"}))),this.lineElement.setAttribute("fill","none"),this.lineElement.style.markerEnd="url(#marker-arrow)",this.updateLine(),this.contextIn.backgroundElement.appendChild(this.lineElement)},o);function o(e,i,s){var c=l.call(this)||this;return c.store=e,c.contextIn=i,c.config=s,c.svgElement=null,c.lineElement=null,c}u.Entity=a;var n,t=(n=d.Base.Repository,b(r,n),r);function r(){return n!==null&&n.apply(this,arguments)||this}u.Repository=t})(f.ConnectionView||(f.ConnectionView={}))},function(E,f,v){var x=this&&this.__read||function(h,u){var l=typeof Symbol=="function"&&h[Symbol.iterator];if(!l)return h;var a,o,n=l.call(h),t=[];try{for(;(u===void 0||0<u--)&&!(a=n.next()).done;)t.push(a.value)}catch(r){o={error:r}}finally{try{a&&!a.done&&(l=n.return)&&l.call(n)}finally{if(o)throw o.error}}return t},b=this&&this.__spread||function(){for(var h=[],u=0;u<arguments.length;u++)h=h.concat(x(arguments[u]));return h};Object.defineProperty(f,"__esModule",{value:!0});var y,g,d=v(0);function m(h,u,l,a,o,n){this.fontFamily=h,this.fontSize=u,this.fontWeight=l,this.lineHeight=a,this.topToBaseLine=o,this.width=n}y=f.Font||(f.Font={}),m.prototype.widthOf=function(h){var u=this;return typeof h=="string"?this.widthOf(Array.from(h)):h.map(function(l){return u.width.get(l)}).reduce(function(l,a){return l+a},0)},g=m,y.ValueObject=g,function(h){function u(o,n,t){var r=new Map,e=new Set(o);e.delete(`
`);var i=Array.from(e);n.textContent=i.join(""),n.parentNode.parentNode.insertBefore(t,n.parentNode),i.forEach(function(L,C){r.set(L,n.getExtentOfChar(C).width)});var s=t.getBoundingClientRect().top-n.getBoundingClientRect().top,c=parseFloat(window.getComputedStyle(n).fontSize),p=window.getComputedStyle(n).fontFamily,w=window.getComputedStyle(n).fontWeight,I=n.getBoundingClientRect().height;return new g(p,c,w,I,s,r)}h.create=u;var l=(a.prototype.thanCreate=function(o,n){var t,r;(t=this.measuringElement.classList).add.apply(t,b(o));var e=u(n,this.measuringElement,this.baseLineReferenceElement);return(r=this.measuringElement.classList).remove.apply(r,b(o)),this.result.push(e),this},a.prototype.endBatch=function(){return this.baseLineReferenceElement.remove(),this.measuringElement.remove(),this.result},a);function a(o,n){this.svgElement=o,this.textElement=n,this.baseLineReferenceElement=document.createElementNS(d.SVGNS,"rect"),this.baseLineReferenceElement.setAttribute("width","1px"),this.baseLineReferenceElement.setAttribute("height","1px"),this.svgElement.appendChild(this.baseLineReferenceElement),this.measuringElement=document.createElementNS(d.SVGNS,"tspan"),this.textElement.appendChild(this.measuringElement),this.result=[]}h.startBatch=function(o,n){return new l(o,n)}}(y.Factory||(y.Factory={})),(y.Service||(y.Service={})).measureMore=function(h,u,l,a){var o,n=new Set(u);n.delete(`
`);var t=Array.from(n).filter(function(e){return!h.width.has(e)});if(0<t.length){var r=document.createElementNS(d.SVGNS,"tspan");(o=r.classList).add.apply(o,b(l)),r.textContent=t.join(""),a.appendChild(r),t.forEach(function(e,i){h.width.set(e,r.getExtentOfChar(i).width)}),r.remove()}return h}},function(E,f,v){Object.defineProperty(f,"__esModule",{value:!0});var x=v(13);f.Annotator=x.Annotator;var b=v(27),y=v(28),g=v(29),d={Connection:b.Connection,Label:y.Label,Content:g.Content};f.Action=d},function(E,f,v){var x,b=this&&this.__extends||(x=function(t,r){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var s in i)i.hasOwnProperty(s)&&(e[s]=i[s])})(t,r)},function(t,r){function e(){this.constructor=t}x(t,r),t.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)});Object.defineProperty(f,"__esModule",{value:!0});var y,g=v(3),d=v(14),m=v(17),h=v(0),u=v(24),l=v(25),a=v(26),o=(y=g.EventEmitter,b(n,y),n.prototype.applyAction=function(t){t.apply(this.store)},n.prototype.export=function(){this.view.contentEditor.hide();var t=this.view.svgElement.outerHTML.replace(/&nbsp;/," ");return this.view.contentEditor.show(),t},n.prototype.remove=function(){this.view.svgElement.remove(),this.store.config.contentEditable&&this.view.contentEditor.remove()},n);function n(t,r,e){var i=y.call(this)||this;i.containerElement=r,i.configInput=e;var s=u.parseInput(e||{});i.store=new d.Store(s),i.store.json=typeof t=="string"?JSON.parse(t):t;var c=document.createElementNS(h.SVGNS,"svg");return c.setAttribute("xmlns",h.SVGNS),r.appendChild(c),i.view=new m.View(i,c,s),i.textSelectionHandler=new l.TextSelectionHandler(i,s),i.twoLabelsClickedHandler=new a.TwoLabelsClickedHandler(i,s),i}f.Annotator=o},function(E,f,v){var x,b=this&&this.__extends||(x=function(o,n){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(o,n)},function(o,n){function t(){this.constructor=o}x(o,n),o.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)});Object.defineProperty(f,"__esModule",{value:!0});var y,g=v(15),d=v(8),m=v(16),h=v(9),u=v(3),l=(y=u.EventEmitter,b(a,y),Object.defineProperty(a.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"json",{get:function(){return{content:this._content,labelCategories:this.labelCategoryRepo.json,labels:this.labelRepo.json,connectionCategories:this.connectionCategoryRepo.json,connections:this.connectionRepo.json}},set:function(o){var n=this;this._content=o.content.endsWith(`
`)?o.content:o.content+`
`,g.LabelCategory.Factory.createAll(o.labelCategories,this.config).map(function(t){return n.labelCategoryRepo.add(t)}),d.Label.Factory.createAll(o.labels,this).map(function(t){return n.labelRepo.add(t)}),o.connectionCategories.map(function(t){return n.connectionCategoryRepo.add(t)}),h.Connection.Factory.createAll(o.connections,this).map(function(t){return n.connectionRepo.add(t)})},enumerable:!0,configurable:!0}),a.prototype.contentSlice=function(o,n){return this.content.slice(o,n)},a.prototype.moveLabels=function(o,n){Array.from(this.labelRepo.values()).filter(function(t){return t.startIndex>=o}).map(function(t){return t.move(n)})},a.prototype.spliceContent=function(o,n){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var e=o+n;if(n===0||Array.from(this.labelRepo.values()).find(function(w){return w.startIndex<=o&&o<w.endIndex||w.startIndex<e&&e<w.endIndex})===void 0){var i=this.content.slice(0,o),s=this.content.slice(o,o+n),c=t.join(""),p=this.content.slice(o+n);this._content=i+c+p,this.moveLabels(o+n,c.length-s.length),this.emit("contentSpliced",o,s,c)}},a);function a(o){var n=y.call(this)||this;return n._content="",n.config=o,n.labelCategoryRepo=new g.LabelCategory.Repository,n.labelRepo=new d.Label.Repository(o),n.connectionCategoryRepo=new m.ConnectionCategory.Repository,n.connectionRepo=new h.Connection.Repository(o),n}f.Store=l},function(E,f,v){var x,b=this&&this.__extends||(x=function(o,n){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(o,n)},function(o,n){function t(){this.constructor=o}x(o,n),o.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)});Object.defineProperty(f,"__esModule",{value:!0});var y,g,d,m,h=v(1),u=v(5);function l(){return g!==null&&g.apply(this,arguments)||this}function a(o,n){var t=o.borderColor,r=o.color;return!o.borderColor&&o["border-color"]&&(t=o["border-color"]),o.color||(r=n),o.borderColor||(t=u.shadeColor(r,-30)),{id:o.id,text:o.text,color:r,borderColor:t}}y=f.LabelCategory||(f.LabelCategory={}),g=h.Base.Repository,b(l,g),m=l,y.Repository=m,(d=y.Factory||(y.Factory={})).create=a,d.createAll=function(o,n){return o.map(function(t){return a(t,n.defaultLabelColor)})}},function(E,f,v){var x,b=this&&this.__extends||(x=function(u,l){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,o){a.__proto__=o}||function(a,o){for(var n in o)o.hasOwnProperty(n)&&(a[n]=o[n])})(u,l)},function(u,l){function a(){this.constructor=u}x(u,l),u.prototype=l===null?Object.create(l):(a.prototype=l.prototype,new a)});Object.defineProperty(f,"__esModule",{value:!0});var y,g,d,m=v(1);function h(){return g!==null&&g.apply(this,arguments)||this}y=f.ConnectionCategory||(f.ConnectionCategory={}),g=m.Base.Repository,b(h,g),d=h,y.Repository=d},function(E,f,v){var x=this&&this.__read||function(e,i){var s=typeof Symbol=="function"&&e[Symbol.iterator];if(!s)return e;var c,p,w=s.call(e),I=[];try{for(;(i===void 0||0<i--)&&!(c=w.next()).done;)I.push(c.value)}catch(L){p={error:L}}finally{try{c&&!c.done&&(s=w.return)&&s.call(w)}finally{if(p)throw p.error}}return I},b=this&&this.__spread||function(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(x(arguments[i]));return e},y=this&&this.__values||function(e){var i=typeof Symbol=="function"&&Symbol.iterator,s=i&&e[i],c=0;if(s)return s.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&c>=e.length&&(e=void 0),{value:e&&e[c++],done:!e}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(f,"__esModule",{value:!0});var g=v(0),d=v(18),m=v(11),h=v(21),u=v(7),l=v(10),a=v(22),o=v(23),n=v(2),t=(r.layoutTopContextsAfter=function(e){for(;e.next.isSome;)e.topContext.update(),e=e.next.toNullable();e.topContext.update()},r.prototype.constructLabelViewsForLine=function(e){var i=this,s=this.store.labelRepo.getEntitiesInRange(e.startIndex,e.endIndex).map(function(c){return new u.LabelView.Entity(c,e.topContext,i.config)});return s.map(function(c){return i.labelViewRepository.add(c)}),s.map(function(c){return e.topContext.addChild(c)}),s},r.prototype.constructConnectionsForLine=function(e){var i=this;return this.store.labelRepo.getEntitiesInRange(e.startIndex,e.endIndex).map(function(s){var c=s.sameLineConnections.filter(function(p){return!i.connectionViewRepository.has(p.id)}).map(function(p){return new l.ConnectionView.Entity(p,e.topContext,i.config)});return c.map(function(p){return i.connectionViewRepository.add(p)}),c.map(function(p){return e.topContext.addChild(p)}),c}).reduce(function(s,c){return s.concat(c)},[])},Object.defineProperty(r.prototype,"height",{get:function(){var e=this;return this.lines.reduce(function(i,s){return i+s.height+e.contentFont.fontSize*(e.config.lineHeight-1)},20)},enumerable:!0,configurable:!0}),r.createMarkerElement=function(){var e=document.createElementNS(g.SVGNS,"path");e.setAttribute("d","M0,4 L0,8 L6,6 L0,4 L0,8"),e.setAttribute("stroke","#000000"),e.setAttribute("fill","#000000");var i=document.createElementNS(g.SVGNS,"marker");return i.setAttribute("id","marker-arrow"),i.setAttribute("markerWidth","8"),i.setAttribute("markerHeight","10"),i.setAttribute("orient","auto"),i.setAttribute("refX","5"),i.setAttribute("refY","6"),i.appendChild(e),i},r.prototype.contentWidth=function(e,i){return this.contentFont.widthOf(this.store.contentSlice(e,i))},r.prototype.removeLine=function(e){var i=this;e.remove(),e.topContext.children.forEach(function(s){s instanceof u.LabelView.Entity?i.labelViewRepository.delete(s):s instanceof l.ConnectionView.Entity&&i.connectionViewRepository.delete(s)})},r.prototype.registerEventHandlers=function(){var e=this;this.textElement.onmouseup=function(i){window.getSelection().type==="Range"?e.root.textSelectionHandler.textSelected():e.config.contentEditable&&e.contentEditor.caretChanged(i.clientY)},this.store.labelRepo.on("created",this.onLabelCreated.bind(this)),this.store.labelRepo.on("removed",function(i){var s=e.labelViewRepository.get(i.id);s.lineIn.topContext.removeChild(s),s.remove(),e.labelViewRepository.delete(s),s.lineIn.topContext.update(),s.lineIn.update(),r.layoutTopContextsAfter(s.lineIn),e.config.contentEditable&&e.contentEditor.update()}),this.store.connectionRepo.on("created",this.onConnectionCreated.bind(this)),this.store.connectionRepo.on("removed",function(i){var s=e.connectionViewRepository.get(i.id);s.lineIn.topContext.removeChild(s),s.remove(),e.connectionViewRepository.delete(s),s.lineIn.topContext.update(),s.lineIn.update(),r.layoutTopContextsAfter(s.lineIn),e.config.contentEditable&&e.contentEditor.update()}),this.config.contentEditable&&this.store.on("contentSpliced",this.onContentSpliced.bind(this))},r.prototype.rerenderLines=function(e,i){for(var s,c,p,w,I,L,C,_=this.lines[0].svgElement.parentElement,A=e;A<=i;++A)this.removeLine(this.lines[A]);var R=this.lines[e],P=this.lines[i],S=d.Line.Service.divide(this,R.startIndex,P.endIndex);for(S.length!==0&&(S[0].last=R.last,R.last.map(function(j){return j.next=n.some(S[0])}),S[S.length-1].next=P.next,P.next.map(function(j){return j.last=n.some(S[S.length-1])}),(s=this.lines).splice.apply(s,b([e,i-e+1],S)),e===0?P.next.isSome?S[0].insertBefore(P.next):S[0].insertInto(_):S[0].insertAfter(R.last)),A=1;A<S.length;++A)S[A].insertAfter(n.some(S[A-1]));function H(j){G.constructLabelViewsForLine(j).map(function(q){return j.topContext.renderChild(q)})}var G=this;try{for(var F=y(S),k=F.next();!k.done;k=F.next())H(Q=k.value)}catch(j){c={error:j}}finally{try{k&&!k.done&&(p=F.return)&&p.call(F)}finally{if(c)throw c.error}}function U(j){J.constructConnectionsForLine(j).map(function(q){return j.topContext.renderChild(q)})}var J=this;try{for(var V=y(S),T=V.next();!T.done;T=V.next())U(Q=T.value)}catch(j){w={error:j}}finally{try{T&&!T.done&&(I=V.return)&&I.call(V)}finally{if(w)throw w.error}}try{for(var z=y(S),N=z.next();!N.done;N=z.next()){var Q;(Q=N.value).update(),Q.topContext.update()}}catch(j){L={error:j}}finally{try{N&&!N.done&&(C=z.return)&&C.call(z)}finally{if(L)throw L.error}}},r.prototype.onLabelCreated=function(e){var i=x(this.findRangeInLines(e.startIndex,e.endIndex),2),s=i[0];if(i[1]===s+1){var c=this.lines[s],p=new u.LabelView.Entity(e,c.topContext,this.config);this.labelViewRepository.add(p),c.topContext.addChild(p),c.topContext.renderChild(p),c.topContext.update(),c.update()}else{var w=this.findHardLineEndsInIndex(s);this.rerenderLines(s,w)}r.layoutTopContextsAfter(this.lines[s]),this.config.contentEditable&&this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+"px"},r.prototype.findRangeInLines=function(e,i){var s=0,c=0;return this.lines.forEach(function(p,w){p.startIndex<=e&&e<p.endIndex&&(s=w),p.startIndex<=i-1&&i-1<p.endIndex&&(c=w+1)}),[s,c]},r.prototype.onConnectionCreated=function(e){var i=this.labelViewRepository.get(e.priorLabel.id),s=i.lineIn.topContext,c=new l.ConnectionView.Entity(e,s,this.config);this.connectionViewRepository.add(c),s.addChild(c),s.renderChild(c),s.update(),i.lineIn.update(),r.layoutTopContextsAfter(i.lineIn),this.config.contentEditable&&this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+"px"},r.prototype.onContentSpliced=function(e,i,s){i!==""&&this.onRemoved(e,i),s!==""&&this.onInserted(e,s)},r.prototype.onRemoved=function(e,i){var s=x(this.findRangeInLines(e,e+1),2),c=s[0];s[1],this.lines[c].startIndex===e-i.length?this.lines[c].move(-i.length):this.lines[c].inserted(-i.length);for(var p=c+1;p<this.lines.length;)this.lines[p].move(-i.length),++p;var w=this.findHardLineEndsInIndex(c);if(i===`
`&&this.lines[c].isBlank){var I=this.lines[c].last,L=this.lines[c].next;this.lines[c].remove(),this.lines.splice(c,1),I.map(function(_){return _.next=L}),L.map(function(_){return _.last=I})}else this.rerenderLines(c,w);r.layoutTopContextsAfter(this.lines[w-1]);var C=Array.from(i).filter(function(_){return _===`
`}).length;C===0?(this.contentEditor.characterIndex-=i.length,this.contentEditor.avoidInLabel("forward")):0<=this.contentEditor.lineIndex-C&&(this.contentEditor.lineIndex-=C,this.contentEditor.characterIndex=this.contentEditor.line.content.length,this.contentEditor.avoidInLabel("forward")),this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+"px"},r.prototype.onInserted=function(e,i){var s=x(this.findRangeInLines(e,e+1),2),c=s[0];s[1],this.lines[c].startIndex===e+i.length?this.lines[c].move(i.length):this.lines[c].inserted(i.length);for(var p=c+1;p<this.lines.length;)this.lines[p].move(i.length),++p;var w=this.findHardLineEndsInIndex(c);this.rerenderLines(c,w),r.layoutTopContextsAfter(this.lines[w]);var I=Array.from(i),L=I.filter(function(A){return A===`
`}).length,C=I.lastIndexOf(`
`),_=i.length-C;L===0?this.contentEditor.characterIndex+=i.length:(this.contentEditor.lineIndex+=L,this.contentEditor.characterIndex=_-1),this.contentEditor.avoidInLabel("forward"),this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+"px"},r.prototype.findHardLineEndsInIndex=function(e){var i;for(i=e;i<this.lines.length-1&&!this.lines[i].endWithHardLineBreak;++i);return i},r.prototype.collectStyle=function(){var e=document.createElementNS(g.SVGNS,"style"),i=`
        `+this.config.contentClasses.map(function(I){return"."+I}).join(",")+` {
            font-family: `+this.contentFont.fontFamily+`;
            font-weight: `+this.contentFont.fontWeight+`;
            font-size: `+this.contentFont.fontSize+`px;
            line-height: `+this.contentFont.lineHeight+`px;
        }
        `,s=`
        `+this.config.labelClasses.map(function(I){return"."+I}).join(",")+` {
            font-family: `+this.labelFont.fontFamily+`;
            font-weight: `+this.labelFont.fontWeight+`;
            font-size: `+this.labelFont.fontSize+`px;
        }
        `,c=this.config.connectionClasses.map(function(I){return"."+I}).join(","),p=this.config.connectionClasses.map(function(I){return"."+I+"-line"}).join(","),w=`
        `+c+` {
            font-family: `+this.connectionFont.fontFamily+`;
            font-weight: `+this.connectionFont.fontWeight+`;
            font-size: `+this.connectionFont.fontSize+`px;
        }
        `+p+` {
            stroke: #000;
        }
        `;return e.innerHTML=i+s+w,e},Object.defineProperty(r.prototype,"paddingLeft",{get:function(){var e=this;return Math.max.apply(Math,b(Array.from(this.store.labelCategoryRepo.values()).map(function(i){return e.labelFont.widthOf(i.text)})))/2+1},enumerable:!0,configurable:!0}),r);function r(e,i,s){var c,p,w;this.root=e,this.svgElement=i,this.config=s,this.contentEditor=null,this.store=e.store,this.labelViewRepository=new u.LabelView.Repository,this.connectionViewRepository=new l.ConnectionView.Repository,this.markerElement=r.createMarkerElement(),this.svgElement.appendChild(this.markerElement),this.textElement=document.createElementNS(g.SVGNS,"text"),this.textElement.style.whiteSpace="pre",this.textElement.style.wordWrap="normal",this.svgElement.appendChild(this.textElement);var I=Array.from(this.store.labelCategoryRepo.values()).map(function(S){return S.text}).join(""),L=Array.from(this.store.connectionCategoryRepo.values()).map(function(S){return S.text}).join("");c=x(m.Font.Factory.startBatch(i,this.textElement).thanCreate(s.contentClasses,this.store.content).thanCreate(s.labelClasses,I).thanCreate(s.connectionClasses,L).endBatch(),3),this.contentFont=c[0],this.labelFont=c[1],this.connectionFont=c[2];var C=this.labelFont.lineHeight+2+2*s.labelPadding+s.bracketWidth;this.topContextLayerHeight=2*s.topContextMargin+Math.max(C,this.connectionFont.lineHeight),(p=this.textElement.classList).add.apply(p,b(s.contentClasses)),this.labelCategoryElementFactoryRepository=new h.LabelCategoryElement.FactoryRepository(this,s),this.connectionCategoryElementFactoryRepository=new a.ConnectionCategoryElement.FactoryRepository(this,s),this.lineMaxWidth=i.width.baseVal.value-2*this.paddingLeft,this.lines=d.Line.Service.divide(this,0,this.store.content.length),this.lines.map(this.constructLabelViewsForLine.bind(this)),this.lines.map(this.constructConnectionsForLine.bind(this));var _=this.lines.map(function(S){return S.render()});if((w=this.textElement).append.apply(w,b(_)),this.svgElement.style.height=this.height.toString()+"px",this.registerEventHandlers(),this.config.contentEditable){this.contentEditor=new o.ContentEditor(this);var A=x(this.contentEditor.render(),2),R=A[0],P=A[1];this.svgElement.appendChild(R),this.svgElement.parentNode.insertBefore(P,this.svgElement)}this.svgElement.appendChild(this.collectStyle())}f.View=t},function(E,f,v){var x=this&&this.__read||function(h,u){var l=typeof Symbol=="function"&&h[Symbol.iterator];if(!l)return h;var a,o,n=l.call(h),t=[];try{for(;(u===void 0||0<u--)&&!(a=n.next()).done;)t.push(a.value)}catch(r){o={error:r}}finally{try{a&&!a.done&&(l=n.return)&&l.call(n)}finally{if(o)throw o.error}}return t},b=this&&this.__values||function(h){var u=typeof Symbol=="function"&&Symbol.iterator,l=u&&h[u],a=0;if(l)return l.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&a>=h.length&&(h=void 0),{value:h&&h[a++],done:!h}}};throw new TypeError(u?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(f,"__esModule",{value:!0});var y=v(2),g=v(0),d=v(19),m=v(20);(function(h){var u=(Object.defineProperty(l.prototype,"startIndex",{get:function(){return this._startIndex},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"endIndex",{get:function(){return this._endIndex},enumerable:!0,configurable:!0}),l.prototype.move=function(n){this._startIndex+=n,this._endIndex+=n},l.prototype.inserted=function(n){this._endIndex+=n},Object.defineProperty(l.prototype,"dy",{get:function(){return this.last.match(this.view.contentFont.fontSize*this.config.lineHeight,this.view.contentFont.topToBaseLine)+this.topContext.layer*this.view.topContextLayerHeight},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"height",{get:function(){return this.topContext.layer*this.view.topContextLayerHeight+this.view.contentFont.fontSize},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"y",{get:function(){var n=this;return m.takeWhile(this.view.lines,function(t){return t!==n}).reduce(function(t,r){return t+r.height+n.view.contentFont.fontSize*(n.config.lineHeight-1)},0)+this.topContext.layer*this.view.topContextLayerHeight},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isBlank",{get:function(){return this.view.store.content.slice(this.startIndex,this.endIndex-1)===""},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"content",{get:function(){return this.endWithHardLineBreak?this.isBlank?"⮐":this.view.store.content.slice(this.startIndex,this.endIndex-1):this.view.store.content.slice(this.startIndex,this.endIndex)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"endWithHardLineBreak",{get:function(){return this.view.store.content[this.endIndex-1]===`
`},enumerable:!0,configurable:!0}),l.prototype.update=function(){this.svgElement.innerHTML=this.content.replace(/ /g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),this.isBlank&&(this.svgElement.style.fontSize=this.view.contentFont.fontSize/4+"px"),this.svgElement.setAttribute("x",this.view.paddingLeft.toString()),this.svgElement.setAttribute("dy",this.dy.toString()+"px")},l.prototype.render=function(){this.svgElement=document.createElementNS(g.SVGNS,"tspan");var n=x(this.topContext.render(),2),t=n[0],r=n[1];return this.view.svgElement.insertBefore(t,this.view.textElement),this.view.markerElement.insertAdjacentElement("afterend",r),Object.assign(this.svgElement,{annotatorElement:this}),this.update(),this.svgElement},l.prototype.remove=function(){this.topContext.remove(),this.svgElement.remove()},l.prototype.insertBefore=function(n){var t=this;this.render(),n.map(function(r){r.svgElement.parentNode.insertBefore(t.svgElement,r.svgElement),r.topContext.svgElement.parentNode.insertBefore(t.topContext.svgElement,r.topContext.svgElement),r.topContext.backgroundElement.parentNode.insertBefore(t.topContext.backgroundElement,r.topContext.backgroundElement)})},l.prototype.insertAfter=function(n){var t=this;this.render(),n.map(function(r){r.svgElement.insertAdjacentElement("afterend",t.svgElement),r.topContext.svgElement.insertAdjacentElement("afterend",t.topContext.svgElement),r.topContext.backgroundElement.insertAdjacentElement("afterend",t.topContext.backgroundElement)})},l.prototype.insertInto=function(n){this.render(),n.appendChild(this.svgElement)},l);function l(n,t,r,e,i){this.last=r,this.next=e,this.view=i,this.svgElement=null,this._startIndex=n,this._endIndex=t,this.topContext=new d.TopContext(this),this.config=i.config}h.ValueObject=u;var a=(Object.defineProperty(o.prototype,"store",{get:function(){return this.view.store},enumerable:!0,configurable:!0}),o.prototype.divide=function(n,t){var r,e;this.init();var i=n,s=n+1;do{var c=this.mergeLabel(s),p=this.mergeWord(c),w=c===s&&c===p;this.store.content[s-1]===`
`?(this.tokenQueue.length===0?this.reduce(s-1,s):this.reduce(this.tokenQueue[0].startIndex,s),i=s):w&&(this.shiftWithAutoReduce({startIndex:i,endIndex:s}),i=s),++s}while(i<t);function I(A){L.map(function(R){return R.next=y.some(A)}),A.last=L,L=y.some(A)}this.tokenQueue.length!==0&&this.reduce(this.tokenQueue[0].startIndex,this.tokenQueue[this.tokenQueue.length-1].endIndex);var L=y.none;try{for(var C=b(this.result),_=C.next();!_.done;_=C.next())I(_.value)}catch(A){r={error:A}}finally{try{_&&!_.done&&(e=C.return)&&e.call(C)}finally{if(r)throw r.error}}return this.result},o.prototype.init=function(){this.result=[],this.tokenQueue=[]},o.prototype.mergeLabel=function(n){return this.store.labelRepo.getEntitiesCross(n-1).some(function(t){return t.endIndex>n})?this.store.labelRepo.getEntitiesCross(n-1).filter(function(t){return t.endIndex>n}).sort(function(t,r){return r.endIndex-t.endIndex})[0].endIndex:n},o.prototype.mergeWord=function(n){o.wordReg.lastIndex=0;var t=o.wordReg.exec(this.store.contentSlice(n-1,n+1));return t===null?n:t[0].length===2?n+1:n},o.prototype.reduce=function(n,t){var r=new h.ValueObject(n,t,y.none,y.none,this.view);this.result.push(r),this.tokenQueue=[]},o.prototype.shiftWithAutoReduce=function(n){var t=this.tokenQueue.length===0?0:this.view.contentWidth(this.tokenQueue[0].startIndex,this.tokenQueue[this.tokenQueue.length-1].endIndex),r=this.view.contentWidth(n.startIndex,n.endIndex);this.tokenQueue.length!==0&&t+r>this.view.lineMaxWidth&&this.reduce(this.tokenQueue[0].startIndex,this.tokenQueue[this.tokenQueue.length-1].endIndex),r>this.view.lineMaxWidth?(this.reduce(n.startIndex,n.endIndex),console.warn('the token "'+this.store.contentSlice(n.startIndex,n.endIndex)+'" is too long for a line!')):this.tokenQueue.push(n)},o.wordReg=/([a-zA-z][a-zA-Z0-9'’]*[-|.]?)|([+\-]?[0-9.][0-9.%]*)/g,o);function o(n){this.view=n,this.result=[],this.tokenQueue=[]}(h.Service||(h.Service={})).divide=function(n,t,r){return new a(n).divide(t,r)}})(f.Line||(f.Line={}))},function(E,f,v){var x=this&&this.__read||function(o,n){var t=typeof Symbol=="function"&&o[Symbol.iterator];if(!t)return o;var r,e,i=t.call(o),s=[];try{for(;(n===void 0||0<n--)&&!(r=i.next()).done;)s.push(r.value)}catch(c){e={error:c}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return s},b=this&&this.__spread||function(){for(var o=[],n=0;n<arguments.length;n++)o=o.concat(x(arguments[n]));return o},y=this&&this.__values||function(o){var n=typeof Symbol=="function"&&Symbol.iterator,t=n&&o[n],r=0;if(t)return t.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&r>=o.length&&(o=void 0),{value:o&&o[r++],done:!o}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(f,"__esModule",{value:!0});var g=v(0),d=v(6),m=v(10),h=v(4),u=v(7),l=(Object.defineProperty(a.prototype,"layer",{get:function(){return this.children.size===0?0:Math.max.apply(Math,b(Array.from(this.children).map(function(o){return o.layer})))},enumerable:!0,configurable:!0}),a.prototype.update=function(){var o=this;this.children.forEach(function(n){return n.update()}),Array.from(this.children).filter(function(n){return n instanceof u.LabelView.Entity}).map(function(n){n.store.allConnections.forEach(function(t){if(o.belongTo.view.connectionViewRepository.has(t.id)){var r=o.belongTo.view.connectionViewRepository.get(t.id);r.mayNotSameLineLabelView===n&&r.update()}})})},a.prototype.render=function(){var o=this;return this.svgElement=document.createElementNS(g.SVGNS,"g"),this.backgroundElement=document.createElementNS(g.SVGNS,"g"),this.children.forEach(function(n){o.renderChild(n)}),this.update(),[this.svgElement,this.backgroundElement]},a.prototype.addChild=function(o){var n,t,r=this.layer,e=!1;o instanceof m.ConnectionView.Entity&&(o.layer=o.sameLineLabelView.layer);do{++o.layer,e=!1;try{for(var i=(n=void 0,y(this.children)),s=i.next();!s.done;s=i.next()){var c=s.value;if(d.overLaps(o,c)){e=!0;break}}}catch(p){n={error:p}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(n)throw n.error}}}while(e);return this.children.add(o),this.layer-r},a.prototype.renderChild=function(o){h.assert(this.children.has(o));var n=o.render();this.svgElement.appendChild(n)},a.prototype.removeChild=function(o){h.assert(this.children.has(o)),this.children.delete(o)},a.prototype.remove=function(){this.svgElement.remove(),this.backgroundElement.remove()},a);function a(o){this.backgroundElement=null,this.svgElement=null,this.children=new Set,this.belongTo=o}f.TopContext=l},function(E,f,v){Object.defineProperty(f,"__esModule",{value:!0});var x=v(2);f.lookup=function(b,y){return b.length<=y?x.none:x.some(b[y])},f.takeWhile=function(b,y){var g;for(g=0;g<b.length&&y(b[g]);++g);return b.slice(0,g)}},function(E,f,v){var x,b=this&&this.__extends||(x=function(t,r){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var s in i)i.hasOwnProperty(s)&&(e[s]=i[s])})(t,r)},function(t,r){function e(){this.constructor=t}x(t,r),t.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)}),y=this&&this.__values||function(t){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&t[r],i=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(f,"__esModule",{value:!0});var g,d,m,h,u=v(1),l=v(0),a=v(5);function o(t,r,e,i){this.store=t,this.font=r,this.padding=e,this.svgElement=document.createElementNS(l.SVGNS,"g");var s=document.createElementNS(l.SVGNS,"rect");s.setAttribute("fill",/^#/g.test(t.color)?a.addAlpha(t.color,i):t.color),s.setAttribute("stroke",t.borderColor),s.setAttribute("width",this.width.toString()),s.setAttribute("height",(r.lineHeight+2*e).toString()),s.setAttribute("rx",(2*e).toString()),s.style.cursor="pointer";var c=document.createElementNS(l.SVGNS,"text");c.style.userSelect="none",c.style.cursor="pointer",c.textContent=t.text,c.setAttribute("dx",e.toString()),c.setAttribute("dy",r.topToBaseLine+e+"px"),this.svgElement.appendChild(s),this.svgElement.appendChild(c)}function n(t,r){var e,i,s=m.call(this)||this;try{for(var c=y(t.store.labelCategoryRepo.values()),p=c.next();!p.done;p=c.next()){var w=p.value;s.add(new d(w,t.labelFont,r.labelPadding,r.labelOpacity))}}catch(I){e={error:I}}finally{try{p&&!p.done&&(i=c.return)&&i.call(c)}finally{if(e)throw e.error}}return s}g=f.LabelCategoryElement||(f.LabelCategoryElement={}),Object.defineProperty(o.prototype,"width",{get:function(){return this.font.widthOf(this.store.text)+2*this.padding},enumerable:!0,configurable:!0}),o.prototype.create=function(){return this.svgElement.cloneNode(!0)},Object.defineProperty(o.prototype,"id",{get:function(){return this.store.id},enumerable:!0,configurable:!0}),d=o,m=u.Base.Repository,b(n,m),h=n,g.FactoryRepository=h},function(E,f,v){var x,b=this&&this.__extends||(x=function(r,e){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var c in s)s.hasOwnProperty(c)&&(i[c]=s[c])})(r,e)},function(r,e){function i(){this.constructor=r}x(r,e),r.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}),y=this&&this.__read||function(r,e){var i=typeof Symbol=="function"&&r[Symbol.iterator];if(!i)return r;var s,c,p=i.call(r),w=[];try{for(;(e===void 0||0<e--)&&!(s=p.next()).done;)w.push(s.value)}catch(I){c={error:I}}finally{try{s&&!s.done&&(i=p.return)&&i.call(p)}finally{if(c)throw c.error}}return w},g=this&&this.__spread||function(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(y(arguments[e]));return r},d=this&&this.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,i=e&&r[e],s=0;if(i)return i.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&s>=r.length&&(r=void 0),{value:r&&r[s++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(f,"__esModule",{value:!0});var m,h,u,l,a=v(1),o=v(0);function n(r,e,i){var s;this.store=r,this.svgElement=document.createElementNS(o.SVGNS,"g");var c=document.createElementNS(o.SVGNS,"rect");c.setAttribute("fill","#ffffff"),c.setAttribute("width",e.widthOf(r.text).toString()),c.setAttribute("height",e.lineHeight.toString());var p=document.createElementNS(o.SVGNS,"text");(s=p.classList).add.apply(s,g(i)),p.textContent=r.text,p.setAttribute("dy",e.topToBaseLine+"px"),this.svgElement.appendChild(c),this.svgElement.appendChild(p)}function t(r,e){var i,s,c=u.call(this)||this;c.config=e;try{for(var p=d(r.store.connectionCategoryRepo.values()),w=p.next();!w.done;w=p.next()){var I=w.value;u.prototype.add.call(c,new h(I,r.connectionFont,e.connectionClasses))}}catch(L){i={error:L}}finally{try{w&&!w.done&&(s=p.return)&&s.call(p)}finally{if(i)throw i.error}}return c}m=f.ConnectionCategoryElement||(f.ConnectionCategoryElement={}),Object.defineProperty(n.prototype,"id",{get:function(){return this.store.id},enumerable:!0,configurable:!0}),n.prototype.create=function(){return this.svgElement.cloneNode(!0)},h=n,u=a.Base.Repository,b(t,u),l=t,m.FactoryRepository=l},function(E,f,v){var x=this&&this.__read||function(u,l){var a=typeof Symbol=="function"&&u[Symbol.iterator];if(!a)return u;var o,n,t=a.call(u),r=[];try{for(;(l===void 0||0<l--)&&!(o=t.next()).done;)r.push(o.value)}catch(e){n={error:e}}finally{try{o&&!o.done&&(a=t.return)&&a.call(t)}finally{if(n)throw n.error}}return r},b=this&&this.__spread||function(){for(var u=[],l=0;l<arguments.length;l++)u=u.concat(x(arguments[l]));return u};Object.defineProperty(f,"__esModule",{value:!0});var y=v(0),g=v(11),d=v(7),m=(Object.defineProperty(h.prototype,"characterIndex",{get:function(){return this._characterIndex},set:function(u){this.view.lines[this._lineIndex].isBlank?this._characterIndex=0:this._characterIndex=u},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"lineIndex",{get:function(){return this._lineIndex},set:function(u){this._lineIndex=u},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"line",{get:function(){return this.view.lines[this.lineIndex]},enumerable:!0,configurable:!0}),h.prototype.render=function(){var u=this;return this.constructCaretElement(),this.constructHiddenTextAreaElement(),this.parentSVGYOffset=this.view.svgElement.getBoundingClientRect().top-document.getElementsByTagName("html")[0].getBoundingClientRect().top,this.hiddenTextAreaElement.onkeyup=function(l){if(!u.inComposition){switch(l.key){case"ArrowLeft":u.characterIndex===0?u.line.last.isSome&&(--u.lineIndex,u.characterIndex=u.line.content.length):(--u.characterIndex,u.avoidInLabel("backward"));break;case"ArrowRight":u.characterIndex>=u.line.content.length||u.line.isBlank?u.line.next.isSome&&(++u.lineIndex,u.characterIndex=0):(++u.characterIndex,u.avoidInLabel("forward"));break;case"ArrowUp":u.line.last.isSome&&--u.lineIndex,u.characterIndex=Math.min(u.characterIndex,u.line.content.length),u.avoidInLabel("forward");break;case"ArrowDown":u.line.next.isSome&&++u.lineIndex,u.characterIndex=Math.min(u.characterIndex,u.line.content.length),u.avoidInLabel("forward");break;case"Backspace":var a=u.line.startIndex+u.characterIndex-1;u.view.root.emit("contentDelete",a,1);break;default:if(u.hiddenTextAreaElement.value!==""){g.Font.Service.measureMore(u.view.contentFont,u.hiddenTextAreaElement.value,u.view.config.contentClasses,u.view.textElement);var o=u.view.lines[u._lineIndex].startIndex+u.characterIndex;u.view.root.emit("contentInput",o,u.hiddenTextAreaElement.value),u.hiddenTextAreaElement.value=""}}u.update()}},this.hiddenTextAreaElement.addEventListener("compositionstart",function(){u.inComposition=!0}),this.hiddenTextAreaElement.addEventListener("compositionend",function(){u.inComposition=!1}),this.update(),this.hiddenTextAreaElement.style.opacity="0",[this.cursorElement,this.hiddenTextAreaElement]},h.prototype.avoidInLabel=function(u){for(var l=this.line.startIndex+this.characterIndex,a=Array.from(this.line.topContext.children).filter(function(n){return n instanceof d.LabelView.Entity}),o=a.find(function(n){return n.store.startIndex<=l-1&&l<n.store.endIndex});o!==void 0;)u==="forward"?++this.characterIndex:--this.characterIndex,l=this.line.startIndex+this.characterIndex,o=a.find(function(n){return n.store.startIndex<=l-1&&l<n.store.endIndex})},h.prototype.update=function(){var u=this.view.paddingLeft+this.view.contentFont.widthOf(this.line.content.slice(0,this.characterIndex));this.cursorElement.setAttribute("d",`
            M`+u+","+this.line.y+`
            L`+u+","+(this.line.y+this.view.contentFont.lineHeight)+`
        `),this.hiddenTextAreaElement.style.top=this.parentSVGYOffset+this.line.y+"px",this.hiddenTextAreaElement.style.left=this.cursorElement.getBoundingClientRect().left+"px"},h.prototype.caretChanged=function(u){var l=window.getSelection();if(l.type==="Caret"){var a=document.querySelector("svg").getClientRects()[0];if(l.anchorNode.parentNode!==null){var o=l.anchorNode.parentNode.getExtentOfChar(0);if(a.top+o.y+this.view.contentFont.lineHeight<=u){var n=l.anchorNode.parentNode.nextSibling.annotatorElement;this._lineIndex=this.view.lines.indexOf(n),this.characterIndex=0,this.avoidInLabel("forward")}else n=l.anchorNode.parentNode.annotatorElement,this._lineIndex=this.view.lines.indexOf(n),this.characterIndex=l.anchorOffset,this.avoidInLabel("forward");this.update(),this.hiddenTextAreaElement.focus({preventScroll:!0})}}},h.prototype.constructHiddenTextAreaElement=function(){var u;this.hiddenTextAreaElement=document.createElement("textarea"),this.hiddenTextAreaElement.setAttribute("autocorrect","off"),this.hiddenTextAreaElement.setAttribute("autocapitalize","off"),this.hiddenTextAreaElement.setAttribute("spellcheck","false"),(u=this.hiddenTextAreaElement.classList).add.apply(u,b(this.view.config.contentClasses)),this.hiddenTextAreaElement.style.position="absolute",this.hiddenTextAreaElement.style.padding="0",this.hiddenTextAreaElement.style.width="100vw",this.hiddenTextAreaElement.style.height="1em",this.hiddenTextAreaElement.style.outline="none",this.hiddenTextAreaElement.style.zIndex="-1",this.hiddenTextAreaElement.style.borderStyle="none",this.hiddenTextAreaElement.style.fontFamily=this.view.contentFont.fontFamily,this.hiddenTextAreaElement.style.fontSize=this.view.contentFont.fontSize+"px",this.hiddenTextAreaElement.style.fontWeight=this.view.contentFont.fontWeight,this.hiddenTextAreaElement.style.opacity="0"},h.prototype.constructCaretElement=function(){this.cursorElement=document.createElementNS(y.SVGNS,"path"),this.cursorElement.setAttribute("stroke","#000000"),this.cursorElement.setAttribute("stroke-width","1.5"),this.cursorElement.style.animationName="cursor",this.cursorElement.style.animationDuration="0.75s",this.cursorElement.style.animationTimingFunction="ease-out",this.cursorElement.style.animationDirection="alternate",this.cursorElement.style.animationIterationCount="infinite"},h.prototype.hide=function(){this.cursorElement.style.display="none"},h.prototype.show=function(){this.cursorElement.style.display="inline"},h.prototype.remove=function(){this.hiddenTextAreaElement.remove()},h);function h(u){this.view=u,this.cursorElement=null,this.hiddenTextAreaElement=null,this.parentSVGYOffset=null;var l=document.getElementsByTagName("head")[0],a=document.createElement("style");a.innerHTML="@keyframes cursor { from { opacity: 0; } to { opacity: 1; }  }",l.appendChild(a),this._lineIndex=0,this._characterIndex=0,this.inComposition=!1}f.ContentEditor=m},function(E,f,v){Object.defineProperty(f,"__esModule",{value:!0});var x={contentClasses:["poplar-annotation-content"],labelClasses:["poplar-annotation-label"],connectionClasses:["poplar-annotation-connection"],labelPadding:2,lineHeight:1.5,topContextMargin:3,bracketWidth:8,allowMultipleLabel:"differentCategory",allowMultipleConnection:"differentCategory",labelWidthCalcMethod:"max",connectionWidthCalcMethod:"line",labelOpacity:90,defaultLabelColor:"#ff9d61",selectingAreaStrip:/[\n ]/,unconnectedLineStyle:"curve",contentEditable:!0};f.parseInput=function(b){var y={};for(var g in x)y[g]=b[g]!==void 0?b[g]:x[g];return y}},function(E,f,v){var x=this&&this.__read||function(m,h){var u=typeof Symbol=="function"&&m[Symbol.iterator];if(!u)return m;var l,a,o=u.call(m),n=[];try{for(;(h===void 0||0<h--)&&!(l=o.next()).done;)n.push(l.value)}catch(t){a={error:t}}finally{try{l&&!l.done&&(u=o.return)&&u.call(o)}finally{if(a)throw a.error}}return n};Object.defineProperty(f,"__esModule",{value:!0});var b=v(2),y=v(4),g=(d.prototype.getSelectionInfo=function(){var m,h=this,u=window.getSelection();y.assert(u.type==="Range");var l,a,o,n,t=null,r=null;try{t=u.anchorNode.parentNode,r=u.focusNode.parentNode}catch{return null}try{if(l=t.annotatorElement,a=r.annotatorElement,l.view!==this.root.view||a.view!==this.root.view)return null;o=l.startIndex+u.anchorOffset,n=a.startIndex+u.focusOffset}catch{return null}return n<o&&(m=x([n,o],2),o=m[0],n=m[1]),b.fromNullable(this.config.selectingAreaStrip).map(function(e){for(;e.test(h.root.store.content[o]);)++o;for(;e.test(h.root.store.content[n-1]);)--n}),n<=o?null:{startIndex:o,endIndex:n}},d.prototype.textSelected=function(){var m,h=this.getSelectionInfo();h&&this.root.emit("textSelected",h.startIndex,h.endIndex),(m=window.getSelection())===null||m===void 0||m.removeAllRanges()},d);function d(m,h){this.root=m,this.config=h}f.TextSelectionHandler=g},function(E,f,v){var x=this&&this.__read||function(m,h){var u=typeof Symbol=="function"&&m[Symbol.iterator];if(!u)return m;var l,a,o=u.call(m),n=[];try{for(;(h===void 0||0<h--)&&!(l=o.next()).done;)n.push(l.value)}catch(t){a={error:t}}finally{try{l&&!l.done&&(u=o.return)&&u.call(o)}finally{if(a)throw a.error}}return n},b=this&&this.__spread||function(){for(var m=[],h=0;h<arguments.length;h++)m=m.concat(x(arguments[h]));return m};Object.defineProperty(f,"__esModule",{value:!0});function y(m,h){var u,l=this;this.root=m,this.config=h,this.lastSelection=d.none,this.svgElement=document.createElementNS(g.SVGNS,"path"),(u=this.svgElement.classList).add.apply(u,b(m.view.config.connectionClasses.map(function(a){return a+"-line"}))),this.svgElement.setAttribute("fill","none"),this.svgElement.style.markerEnd="url(#marker-arrow)",this.root.on("labelClicked",function(a){l.lastSelection.isSome?(l.root.emit("twoLabelsClicked",l.lastSelection.toNullable().id,a),l.svgElement.remove(),l.svgElement.setAttribute("d",""),l.lastSelection=d.none):(l.lastSelection=d.some(l.root.view.labelViewRepository.get(a)),l.root.view.svgElement.insertBefore(l.svgElement,l.root.view.svgElement.firstChild))}),this.root.view.svgElement.onmousemove=function(a){l.lastSelection.map(function(o){var n=o.labelLeft+1,t=o.labelRight-1,r=o.globalY+1,e=a.clientX-l.root.view.svgElement.getBoundingClientRect().left,i=a.clientY-l.root.view.svgElement.getBoundingClientRect().top,s=(n+t)/2<e?n:t;if(h.unconnectedLineStyle==="straight")l.svgElement.setAttribute("d",`
                    M`+s+","+r+`
                    L`+e+","+i+`
                `);else if(h.unconnectedLineStyle==="curve"){var c=(n-e)/4,p=Math.min(r,i)-20;l.svgElement.setAttribute("d",`
                        M`+s+","+r+`
                        C`+(s-c)+","+p+","+(e+c)+","+p+","+e+","+i+`
                    `)}})},this.root.view.svgElement.oncontextmenu=function(a){l.lastSelection.map(function(){l.svgElement.remove(),l.svgElement.setAttribute("d",""),l.lastSelection=d.none,a.preventDefault()})}}var g=v(0),d=v(2);f.TwoLabelsClickedHandler=y},function(E,f,v){Object.defineProperty(f,"__esModule",{value:!0});var x=v(9);(function(b){var y=(g.prototype.apply=function(a){a.connectionRepo.add(new x.Connection.Entity(null,this.categoryId,this.fromId,this.toId,a))},g);function g(a,o,n){this.categoryId=a,this.fromId=o,this.toId=n}b.CreateConnectionAction=y,b.Create=function(a,o,n){return new y(a,o,n)};var d=(m.prototype.apply=function(a){a.connectionRepo.delete(this.id)},m);function m(a){this.id=a}function h(a){return new d(a)}b.DeleteConnectionAction=d,b.Delete=h;var u=(l.prototype.apply=function(a){var o=a.connectionRepo.get(this.connectionId);h(this.connectionId).apply(a),a.connectionRepo.add(new x.Connection.Entity(this.connectionId,this.categoryId,o.fromId,o.toId,a))},l);function l(a,o){this.connectionId=a,this.categoryId=o}b.UpdateConnectionAction=u,b.Update=function(a,o){return new u(a,o)}})(f.Connection||(f.Connection={}))},function(E,f,v){var x=this&&this.__values||function(y){var g=typeof Symbol=="function"&&Symbol.iterator,d=g&&y[g],m=0;if(d)return d.call(y);if(y&&typeof y.length=="number")return{next:function(){return y&&m>=y.length&&(y=void 0),{value:y&&y[m++],done:!y}}};throw new TypeError(g?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(f,"__esModule",{value:!0});var b=v(8);(function(y){var g=(d.prototype.apply=function(o){if(o.content.slice(this.startIndex,this.endIndex).includes(`
`))throw Error("Insert label across hard line is not supported now! Please remove the \\n in content first!");o.labelRepo.add(new b.Label.Entity(null,this.categoryId,this.startIndex,this.endIndex,o))},d);function d(o,n,t){this.categoryId=o,this.startIndex=n,this.endIndex=t}y.CreateLabelAction=g,y.Create=function(o,n,t){return new g(o,n,t)};var m=(h.prototype.apply=function(o){var n,t;try{for(var r=x(o.labelRepo.get(this.id).allConnections),e=r.next();!e.done;e=r.next()){var i=e.value;o.connectionRepo.delete(i)}}catch(s){n={error:s}}finally{try{e&&!e.done&&(t=r.return)&&t.call(r)}finally{if(n)throw n.error}}o.labelRepo.delete(this.id)},h);function h(o){this.id=o}function u(o){return new m(o)}y.DeleteLabelAction=m,y.Delete=u;var l=(a.prototype.apply=function(o){var n=o.labelRepo.get(this.labelId),t=n.allConnections;u(this.labelId).apply(o),o.labelRepo.add(new b.Label.Entity(this.labelId,this.categoryId,n.startIndex,n.endIndex,o)),t.forEach(function(r){return o.connectionRepo.add(r)})},a);function a(o,n){this.labelId=o,this.categoryId=n}y.UpdateLabelAction=l,y.Update=function(o,n){return new l(o,n)}})(f.Label||(f.Label={}))},function(E,f,v){var x,b;function y(g,d,m){this.startIndex=g,this.removeLength=d,this.insert=m}Object.defineProperty(f,"__esModule",{value:!0}),x=f.Content||(f.Content={}),y.prototype.apply=function(g){if(!g.config.contentEditable)throw Error("Content edition is not on!");g.spliceContent(this.startIndex,this.removeLength,this.insert)},b=y,x.SpliceAction=b,x.Splice=function(g,d,m){return new b(g,d,m)}}],O.c=M,O.d=function(E,f,v){O.o(E,f)||Object.defineProperty(E,f,{enumerable:!0,get:v})},O.r=function(E){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(E,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(E,"__esModule",{value:!0})},O.t=function(E,f){if(1&f&&(E=O(E)),8&f||4&f&&typeof E=="object"&&E&&E.__esModule)return E;var v=Object.create(null);if(O.r(v),Object.defineProperty(v,"default",{enumerable:!0,value:E}),2&f&&typeof E!="string")for(var x in E)O.d(v,x,(function(b){return E[b]}).bind(null,x));return v},O.n=function(E){var f=E&&E.__esModule?function(){return E.default}:function(){return E};return O.d(f,"a",f),f},O.o=function(E,f){return Object.prototype.hasOwnProperty.call(E,f)},O.p="",O(O.s=12);function O(E){if(M[E])return M[E].exports;var f=M[E]={i:E,l:!1,exports:{}};return B[E].call(f.exports,f,f.exports,O),f.l=!0,f.exports}var B,M})})(re);var se=re.exports;const ae={"feedback-component":"_feedback-component_19zwz_1"},le=ie.styled(ae);function ce({data:W}){const X=K.useRef(null),O=K.useRef();return K.useEffect(()=>{O.current!=null&&(X.current=new se.Annotator(W,O.current,{}))},[O.current,W]),le("div.feedback-component",{ref:O})}const me={title:"Feedback components/FeedbackComponent",component:ce},ue={content:"Daven is currently doing all of Macrostrat's user interface development.",labelCategories:[{id:"person",text:"Person",color:"#8888FF",borderColor:"#8888AA"},{id:"task",text:"Task",color:"#2288FF",borderColor:"#2288AA"}],labels:[{id:"t1",categoryId:"person",startIndex:0,endIndex:5},{id:"t2",categoryId:"task",startIndex:45,endIndex:71}],connectionCategories:[{id:"does",text:"does everything"}],connections:[{id:"l1",categoryId:"does",fromId:"t1",toId:"t2"}]},Y={args:{data:ue}},he=`The Barstow Formation is well-known for its fossil mammals
and is the type area for many species that define the Barstovian Land Mammal Age
(Wood et al., 1941; Tedford et al., 1987). It also contains a variety of mammal tracks,
including those of camels, antelopes, cats, dogs, bear-dogs, birds, artiodactyls,
and proboscidians (Alf, 1966; Reynolds and Woodburne, 2001; Reynolds, 2004).
These tracks were commonly made on mud flats interpreted as lake shoreline deposits.
The resulting mudstones are relatively friable, but when covered by resistant
lithologies such as tuff, tuffaceous sandstone, or limestone, natural casts of
the tracks are preserved on the undersides of the beds (Alf, 1966).
Tracks are also found on the upper surfaces of resistant beds such as
tuff and tuffaceous sandstone (R. Reynolds, written comm., 2006).`,de=he.replace(/\n/g," "),D={args:{data:{content:de,labelCategories:[],labels:[],connectionCategories:[],connections:[]}}};var Z,$,ee;Y.parameters={...Y.parameters,docs:{...(Z=Y.parameters)==null?void 0:Z.docs,source:{originalSource:`{
  args: {
    data: data1
  }
}`,...(ee=($=Y.parameters)==null?void 0:$.docs)==null?void 0:ee.source}}};var te,ne,oe;D.parameters={...D.parameters,docs:{...(te=D.parameters)==null?void 0:te.docs,source:{originalSource:`{
  args: {
    data: {
      content: content1,
      labelCategories: [
        // {
        //   id: "stratigrapic-name",
        //   text: "Stratigraphic name",
        //   color: "#8888FF",
        //   borderColor: "#8888AA",
        // },
        // {
        //   id: "lithology",
        //   text: "Lithology",
        //   color: "#2288FF",
        //   borderColor: "#2288AA",
        // },
        // {
        //   id: "location",
        //   text: "Location",
        //   color: "#FF8888",
        //   borderColor: "#AA8888",
        // },
        // {
        //   id: "interpretation",
        //   text: "Interpretation",
        //   color: "#88FF88",
        //   borderColor: "#88AA88",
        // },
      ],
      labels: [
        // {
        //   id: "t1",
        //   categoryId: "stratigraphic-name",
        //   startIndex: 4,
        //   endIndex: 18,
        // },
        // {
        //   id: "t2",
        //   categoryId: "lithology",
        //   startIndex: 233,
        //   endIndex: 238,
        // },
        // {
        //   id: "t3",
        //   categoryId: "location",
        //   startIndex: 241,
        //   endIndex: 254,
        // },
        // {
        //   id: "t4",
        //   categoryId: "interpretation",
        //   startIndex: 255,
        //   endIndex: 264,
        // },
      ],
      connectionCategories: [
        // {
        //   id: "is",
        //   text: "is",
        // },
        // {
        //   id: "contains",
        //   text: "contains",
        // },
        // {
        //   id: "interpreted",
        //   text: "is interpreted as",
        // },
      ],
      connections: [
        // {
        //   id: "l1",
        //   categoryId: "contains",
        //   fromId: "t1",
        //   toId: "t2",
        // },
        // {
        //   id: "l2",
        //   categoryId: "is",
        //   fromId: "t2",
        //   toId: "t3",
        // },
        // {
        //   id: "l3",
        //   categoryId: "interpreted",
        //   fromId: "t3",
        //   toId: "t4",
        // },
      ]
    }
  }
}`,...(oe=(ne=D.parameters)==null?void 0:ne.docs)==null?void 0:oe.source}}};const ge=["Basic","BarstowFormation"];export{D as BarstowFormation,Y as Basic,ge as __namedExportsOrder,me as default};
