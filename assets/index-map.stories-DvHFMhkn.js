import{m as H}from"./index.modern-CqpcyjV2.js";import{g as ni,e as Bt,a as Te,d as Ot,b as ze,n as ti,c as ei,s as kt,f as cn,h as an,r as fn,F as Tn,i as ii,M as ri,G as oi}from"./index-CqstFL58.js";import{h as li,A as si}from"./index-BQakYib5.js";import"./toaster-CUxSLCcg.js";import{r as sn}from"./index-BBkUAzwr.js";import"./index-DtBkkNk_.js";import{u as ui}from"./layout-hooks-CTKpfRS_.js";import{c as ci}from"./chroma-Bi8DEGLa.js";import{a as ai}from"./index-DwtI8WR9.js";import"./index-C9bLEcPW.js";import"./tslib.es6-ChmHIYM0.js";import"./removeClass-BFK1mqj1.js";import"./assertThisInitialized-CtXiITI_.js";import"./index-_4_hgnnR.js";import"./ResizeObserver-CGzHS_VR.js";import"./buttons-ClSVyNZf.js";import"./iconSvgPaths-uSutIUG7.js";import"./classes-BP-FkMqc.js";import"./index-PqR-_bA4.js";import"./clsx.m-Bv3bvwjZ.js";import"./clsx.m-irjavGej.js";import"./buttons-CKwIiXPX.js";import"./unitless.browser.esm-CW87jbl0.js";import"./getPrototypeOf-BYVhAdwF.js";import"./Google-cn5MAfvL.js";import"./isUndefined-CmGWwQE3.js";import"./_baseAssignValue-CoIWEOUD.js";import"./_baseEach-C_68pHMe.js";import"./isString-DtNrtdxl.js";import"./isPlainObject-DY1xBG4K.js";import"./cloneDeep-9TMxW8q_.js";import"./_initCloneObject-CeqP1Y0d.js";import"./axios-Bqepj0vs.js";import"./group-Bf4Jec6Z.js";import"./buttonGroup-Dyi9Gksa.js";import"./callout-8N1lTIPz.js";import"./text-C6o5Hbyo.js";import"./overlay-j4w1GPD7.js";import"./TransitionGroup-BEjLb10U.js";import"./index-BQ5IbGbl.js";function Fe(e,n){let t,i;if(n===void 0)for(const r of e)r!=null&&(t===void 0?r>=r&&(t=i=r):(t>r&&(t=r),i<r&&(i=r)));else{let r=-1;for(let o of e)(o=n(o,++r,e))!=null&&(t===void 0?o>=o&&(t=i=o):(t>o&&(t=o),i<o&&(i=o)))}return[t,i]}class Nn{constructor(){this._partials=new Float64Array(32),this._n=0}add(n){const t=this._partials;let i=0;for(let r=0;r<this._n&&r<32;r++){const o=t[r],l=n+o,s=Math.abs(n)<Math.abs(o)?n-(l-o):o-(l-n);s&&(t[i++]=s),n=l}return t[i]=n,this._n=i+1,this}valueOf(){const n=this._partials;let t=this._n,i,r,o,l=0;if(t>0){for(l=n[--t];t>0&&(i=l,r=n[--t],l=i+r,o=r-(l-i),!o););t>0&&(o<0&&n[t-1]<0||o>0&&n[t-1]>0)&&(r=o*2,i=l+r,r==i-l&&(l=i))}return l}}function*fi(e){for(const n of e)yield*n}function Le(e){return Array.from(fi(e))}function hi(e,n=void 0,t=void 0){Array.isArray(n)&&(t=n,n={});const{event:i="keydown",keys:r=[],target:o=document}=n,l=sn.useCallback(s=>{(r.length===0||r.includes(s.key))&&e(s)},[e,r]);return pi(o,i,l,t)}function pi(e,n,t,i=void 0){const r=i?sn.useCallback(t,i):t;sn.useEffect(()=>{const o=l=>{r(l)};return e.addEventListener(n,o),()=>{e.removeEventListener(n,o)}},[r,n,e])}var In,On,Un,Zn,Wn,Vn,Jn,Qn,vt,_t,wt,be,ke,B,O,U,rn={sphere:ti,point:Rt,lineStart:Ut,lineEnd:Zt,polygonStart:function(){rn.lineStart=mi,rn.lineEnd=yi},polygonEnd:function(){rn.lineStart=Ut,rn.lineEnd=Zt}};function Rt(e,n){e*=fn,n*=fn;var t=cn(n);Fn(t*cn(e),t*an(e),an(n))}function Fn(e,n,t){++In,Un+=(e-Un)/In,Zn+=(n-Zn)/In,Wn+=(t-Wn)/In}function Ut(){rn.point=gi}function gi(e,n){e*=fn,n*=fn;var t=cn(n);B=t*cn(e),O=t*an(e),U=an(n),rn.point=di,Fn(B,O,U)}function di(e,n){e*=fn,n*=fn;var t=cn(n),i=t*cn(e),r=t*an(e),o=an(n),l=Te(kt((l=O*o-U*r)*l+(l=U*i-B*o)*l+(l=B*r-O*i)*l),B*i+O*r+U*o);On+=l,Vn+=l*(B+(B=i)),Jn+=l*(O+(O=r)),Qn+=l*(U+(U=o)),Fn(B,O,U)}function Zt(){rn.point=Rt}function mi(){rn.point=vi}function yi(){Re(be,ke),rn.point=Rt}function vi(e,n){be=e,ke=n,e*=fn,n*=fn,rn.point=Re;var t=cn(n);B=t*cn(e),O=t*an(e),U=an(n),Fn(B,O,U)}function Re(e,n){e*=fn,n*=fn;var t=cn(n),i=t*cn(e),r=t*an(e),o=an(n),l=O*o-U*r,s=U*i-B*o,a=B*r-O*i,f=kt(l*l+s*s+a*a),c=ze(f),u=f&&-c/f;vt+=u*l,_t+=u*s,wt+=u*a,On+=c,Vn+=c*(B+(B=i)),Jn+=c*(O+(O=r)),Qn+=c*(U+(U=o)),Fn(B,O,U)}function je(e){In=On=Un=Zn=Wn=Vn=Jn=Qn=vt=_t=wt=0,ni(e,rn);var n=vt,t=_t,i=wt,r=n*n+t*t+i*i;return r<Bt&&(n=Vn,t=Jn,i=Qn,On<ei&&(n=Un,t=Zn,i=Wn),r=n*n+t*t+i*i,r<Bt)?[NaN,NaN]:[Te(t,n)*Ot,ze(i/kt(r))*Ot]}function _i(e){return e}function wi(e){if(e==null)return _i;var n,t,i=e.scale[0],r=e.scale[1],o=e.translate[0],l=e.translate[1];return function(s,a){a||(n=t=0);var f=2,c=s.length,u=new Array(c);for(u[0]=(n+=s[0])*i+o,u[1]=(t+=s[1])*r+l;f<c;)u[f]=s[f],++f;return u}}function Si(e,n){for(var t,i=e.length,r=i-n;r<--i;)t=e[r],e[r++]=e[i],e[i]=t}function De(e,n){return typeof n=="string"&&(n=e.objects[n]),n.type==="GeometryCollection"?{type:"FeatureCollection",features:n.geometries.map(function(t){return Wt(e,t)})}:Wt(e,n)}function Wt(e,n){var t=n.id,i=n.bbox,r=n.properties==null?{}:n.properties,o=Mi(e,n);return t==null&&i==null?{type:"Feature",properties:r,geometry:o}:i==null?{type:"Feature",id:t,properties:r,geometry:o}:{type:"Feature",id:t,bbox:i,properties:r,geometry:o}}function Mi(e,n){var t=wi(e.transform),i=e.arcs;function r(c,u){u.length&&u.pop();for(var h=i[c<0?~c:c],p=0,g=h.length;p<g;++p)u.push(t(h[p],p));c<0&&Si(u,g)}function o(c){return t(c)}function l(c){for(var u=[],h=0,p=c.length;h<p;++h)r(c[h],u);return u.length<2&&u.push(u[0]),u}function s(c){for(var u=l(c);u.length<4;)u.push(u[0]);return u}function a(c){return c.map(s)}function f(c){var u=c.type,h;switch(u){case"GeometryCollection":return{type:u,geometries:c.geometries.map(f)};case"Point":h=o(c.coordinates);break;case"MultiPoint":h=c.coordinates.map(o);break;case"LineString":h=l(c.arcs);break;case"MultiLineString":h=c.arcs.map(l);break;case"Polygon":h=a(c.arcs);break;case"MultiPolygon":h=c.arcs.map(a);break;default:return null}return{type:u,coordinates:h}}return f(n)}const Ei=({fill:e="rgb(233, 252, 234)",stroke:n="transparent",useCanvas:t=!1})=>{const[i,r]=sn.useState(null);return sn.useEffect(()=>{ai.get("https://unpkg.com/world-atlas@1/world/110m.json").then(o=>{const{data:l}=o,s=De(l,l.objects.land);r(s)})},[]),H(Tn,{useCanvas:t,style:{fill:e,stroke:n},geometry:i})},pn=11102230246251565e-32,K=134217729,$i=(3+8*pn)*pn;function gt(e,n,t,i,r){let o,l,s,a,f=n[0],c=i[0],u=0,h=0;c>f==c>-f?(o=f,f=n[++u]):(o=c,c=i[++h]);let p=0;if(u<e&&h<t)for(c>f==c>-f?(l=f+o,s=o-(l-f),f=n[++u]):(l=c+o,s=o-(l-c),c=i[++h]),o=l,s!==0&&(r[p++]=s);u<e&&h<t;)c>f==c>-f?(l=o+f,a=l-o,s=o-(l-a)+(f-a),f=n[++u]):(l=o+c,a=l-o,s=o-(l-a)+(c-a),c=i[++h]),o=l,s!==0&&(r[p++]=s);for(;u<e;)l=o+f,a=l-o,s=o-(l-a)+(f-a),f=n[++u],o=l,s!==0&&(r[p++]=s);for(;h<t;)l=o+c,a=l-o,s=o-(l-a)+(c-a),c=i[++h],o=l,s!==0&&(r[p++]=s);return(o!==0||p===0)&&(r[p++]=o),p}function Pi(e,n){let t=n[0];for(let i=1;i<e;i++)t+=n[i];return t}function Ln(e){return new Float64Array(e)}const xi=(3+16*pn)*pn,Ii=(2+12*pn)*pn,Ci=(9+64*pn)*pn*pn,wn=Ln(4),Vt=Ln(8),Jt=Ln(12),Qt=Ln(16),X=Ln(4);function Ai(e,n,t,i,r,o,l){let s,a,f,c,u,h,p,g,d,y,v,w,E,M,P,I,A,C;const _=e-r,x=t-r,S=n-o,T=i-o;M=_*T,h=K*_,p=h-(h-_),g=_-p,h=K*T,d=h-(h-T),y=T-d,P=g*y-(M-p*d-g*d-p*y),I=S*x,h=K*S,p=h-(h-S),g=S-p,h=K*x,d=h-(h-x),y=x-d,A=g*y-(I-p*d-g*d-p*y),v=P-A,u=P-v,wn[0]=P-(v+u)+(u-A),w=M+v,u=w-M,E=M-(w-u)+(v-u),v=E-I,u=E-v,wn[1]=E-(v+u)+(u-I),C=w+v,u=C-w,wn[2]=w-(C-u)+(v-u),wn[3]=C;let z=Pi(4,wn),N=Ii*l;if(z>=N||-z>=N||(u=e-_,s=e-(_+u)+(u-r),u=t-x,f=t-(x+u)+(u-r),u=n-S,a=n-(S+u)+(u-o),u=i-T,c=i-(T+u)+(u-o),s===0&&a===0&&f===0&&c===0)||(N=Ci*l+$i*Math.abs(z),z+=_*c+T*s-(S*f+x*a),z>=N||-z>=N))return z;M=s*T,h=K*s,p=h-(h-s),g=s-p,h=K*T,d=h-(h-T),y=T-d,P=g*y-(M-p*d-g*d-p*y),I=a*x,h=K*a,p=h-(h-a),g=a-p,h=K*x,d=h-(h-x),y=x-d,A=g*y-(I-p*d-g*d-p*y),v=P-A,u=P-v,X[0]=P-(v+u)+(u-A),w=M+v,u=w-M,E=M-(w-u)+(v-u),v=E-I,u=E-v,X[1]=E-(v+u)+(u-I),C=w+v,u=C-w,X[2]=w-(C-u)+(v-u),X[3]=C;const m=gt(4,wn,4,X,Vt);M=_*c,h=K*_,p=h-(h-_),g=_-p,h=K*c,d=h-(h-c),y=c-d,P=g*y-(M-p*d-g*d-p*y),I=S*f,h=K*S,p=h-(h-S),g=S-p,h=K*f,d=h-(h-f),y=f-d,A=g*y-(I-p*d-g*d-p*y),v=P-A,u=P-v,X[0]=P-(v+u)+(u-A),w=M+v,u=w-M,E=M-(w-u)+(v-u),v=E-I,u=E-v,X[1]=E-(v+u)+(u-I),C=w+v,u=C-w,X[2]=w-(C-u)+(v-u),X[3]=C;const $=gt(m,Vt,4,X,Jt);M=s*c,h=K*s,p=h-(h-s),g=s-p,h=K*c,d=h-(h-c),y=c-d,P=g*y-(M-p*d-g*d-p*y),I=a*f,h=K*a,p=h-(h-a),g=a-p,h=K*f,d=h-(h-f),y=f-d,A=g*y-(I-p*d-g*d-p*y),v=P-A,u=P-v,X[0]=P-(v+u)+(u-A),w=M+v,u=w-M,E=M-(w-u)+(v-u),v=E-I,u=E-v,X[1]=E-(v+u)+(u-I),C=w+v,u=C-w,X[2]=w-(C-u)+(v-u),X[3]=C;const F=gt($,Jt,4,X,Qt);return Qt[F-1]}function Rn(e,n,t,i,r,o){const l=(n-o)*(t-r),s=(e-r)*(i-o),a=l-s,f=Math.abs(l+s);return Math.abs(a)>=xi*f?a:-Ai(e,n,t,i,r,o,f)}const ne=Math.pow(2,-52),jn=new Uint32Array(512);class nt{static from(n,t=Li,i=bi){const r=n.length,o=new Float64Array(r*2);for(let l=0;l<r;l++){const s=n[l];o[2*l]=t(s),o[2*l+1]=i(s)}return new nt(o)}constructor(n){const t=n.length>>1;if(t>0&&typeof n[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=n;const i=Math.max(2*t-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:n,_hullPrev:t,_hullNext:i,_hullTri:r,_hullHash:o}=this,l=n.length>>1;let s=1/0,a=1/0,f=-1/0,c=-1/0;for(let _=0;_<l;_++){const x=n[2*_],S=n[2*_+1];x<s&&(s=x),S<a&&(a=S),x>f&&(f=x),S>c&&(c=S),this._ids[_]=_}const u=(s+f)/2,h=(a+c)/2;let p,g,d;for(let _=0,x=1/0;_<l;_++){const S=dt(u,h,n[2*_],n[2*_+1]);S<x&&(p=_,x=S)}const y=n[2*p],v=n[2*p+1];for(let _=0,x=1/0;_<l;_++){if(_===p)continue;const S=dt(y,v,n[2*_],n[2*_+1]);S<x&&S>0&&(g=_,x=S)}let w=n[2*g],E=n[2*g+1],M=1/0;for(let _=0;_<l;_++){if(_===p||_===g)continue;const x=zi(y,v,w,E,n[2*_],n[2*_+1]);x<M&&(d=_,M=x)}let P=n[2*d],I=n[2*d+1];if(M===1/0){for(let S=0;S<l;S++)this._dists[S]=n[2*S]-n[0]||n[2*S+1]-n[1];Mn(this._ids,this._dists,0,l-1);const _=new Uint32Array(l);let x=0;for(let S=0,T=-1/0;S<l;S++){const z=this._ids[S],N=this._dists[z];N>T&&(_[x++]=z,T=N)}this.hull=_.subarray(0,x),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(Rn(y,v,w,E,P,I)<0){const _=g,x=w,S=E;g=d,w=P,E=I,d=_,P=x,I=S}const A=Fi(y,v,w,E,P,I);this._cx=A.x,this._cy=A.y;for(let _=0;_<l;_++)this._dists[_]=dt(n[2*_],n[2*_+1],A.x,A.y);Mn(this._ids,this._dists,0,l-1),this._hullStart=p;let C=3;i[p]=t[d]=g,i[g]=t[p]=d,i[d]=t[g]=p,r[p]=0,r[g]=1,r[d]=2,o.fill(-1),o[this._hashKey(y,v)]=p,o[this._hashKey(w,E)]=g,o[this._hashKey(P,I)]=d,this.trianglesLen=0,this._addTriangle(p,g,d,-1,-1,-1);for(let _=0,x,S;_<this._ids.length;_++){const T=this._ids[_],z=n[2*T],N=n[2*T+1];if(_>0&&Math.abs(z-x)<=ne&&Math.abs(N-S)<=ne||(x=z,S=N,T===p||T===g||T===d))continue;let m=0;for(let Q=0,en=this._hashKey(z,N);Q<this._hashSize&&(m=o[(en+Q)%this._hashSize],!(m!==-1&&m!==i[m]));Q++);m=t[m];let $=m,F;for(;F=i[$],Rn(z,N,n[2*$],n[2*$+1],n[2*F],n[2*F+1])>=0;)if($=F,$===m){$=-1;break}if($===-1)continue;let D=this._addTriangle($,T,i[$],-1,-1,r[$]);r[T]=this._legalize(D+2),r[$]=D,C++;let j=i[$];for(;F=i[j],Rn(z,N,n[2*j],n[2*j+1],n[2*F],n[2*F+1])<0;)D=this._addTriangle(j,T,F,r[T],-1,r[j]),r[T]=this._legalize(D+2),i[j]=j,C--,j=F;if($===m)for(;F=t[$],Rn(z,N,n[2*F],n[2*F+1],n[2*$],n[2*$+1])<0;)D=this._addTriangle(F,T,$,-1,r[$],r[F]),this._legalize(D+2),r[F]=D,i[$]=$,C--,$=F;this._hullStart=t[T]=$,i[$]=t[j]=T,i[T]=j,o[this._hashKey(z,N)]=T,o[this._hashKey(n[2*$],n[2*$+1])]=$}this.hull=new Uint32Array(C);for(let _=0,x=this._hullStart;_<C;_++)this.hull[_]=x,x=i[x];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(n,t){return Math.floor(Ni(n-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(n){const{_triangles:t,_halfedges:i,coords:r}=this;let o=0,l=0;for(;;){const s=i[n],a=n-n%3;if(l=a+(n+2)%3,s===-1){if(o===0)break;n=jn[--o];continue}const f=s-s%3,c=a+(n+1)%3,u=f+(s+2)%3,h=t[l],p=t[n],g=t[c],d=t[u];if(Ti(r[2*h],r[2*h+1],r[2*p],r[2*p+1],r[2*g],r[2*g+1],r[2*d],r[2*d+1])){t[n]=d,t[s]=h;const v=i[u];if(v===-1){let E=this._hullStart;do{if(this._hullTri[E]===u){this._hullTri[E]=n;break}E=this._hullPrev[E]}while(E!==this._hullStart)}this._link(n,v),this._link(s,i[l]),this._link(l,u);const w=f+(s+1)%3;o<jn.length&&(jn[o++]=w)}else{if(o===0)break;n=jn[--o]}}return l}_link(n,t){this._halfedges[n]=t,t!==-1&&(this._halfedges[t]=n)}_addTriangle(n,t,i,r,o,l){const s=this.trianglesLen;return this._triangles[s]=n,this._triangles[s+1]=t,this._triangles[s+2]=i,this._link(s,r),this._link(s+1,o),this._link(s+2,l),this.trianglesLen+=3,s}}function Ni(e,n){const t=e/(Math.abs(e)+Math.abs(n));return(n>0?3-t:1+t)/4}function dt(e,n,t,i){const r=e-t,o=n-i;return r*r+o*o}function Ti(e,n,t,i,r,o,l,s){const a=e-l,f=n-s,c=t-l,u=i-s,h=r-l,p=o-s,g=a*a+f*f,d=c*c+u*u,y=h*h+p*p;return a*(u*y-d*p)-f*(c*y-d*h)+g*(c*p-u*h)<0}function zi(e,n,t,i,r,o){const l=t-e,s=i-n,a=r-e,f=o-n,c=l*l+s*s,u=a*a+f*f,h=.5/(l*f-s*a),p=(f*c-s*u)*h,g=(l*u-a*c)*h;return p*p+g*g}function Fi(e,n,t,i,r,o){const l=t-e,s=i-n,a=r-e,f=o-n,c=l*l+s*s,u=a*a+f*f,h=.5/(l*f-s*a),p=e+(f*c-s*u)*h,g=n+(l*u-a*c)*h;return{x:p,y:g}}function Mn(e,n,t,i){if(i-t<=20)for(let r=t+1;r<=i;r++){const o=e[r],l=n[o];let s=r-1;for(;s>=t&&n[e[s]]>l;)e[s+1]=e[s--];e[s+1]=o}else{const r=t+i>>1;let o=t+1,l=i;xn(e,r,o),n[e[t]]>n[e[i]]&&xn(e,t,i),n[e[o]]>n[e[i]]&&xn(e,o,i),n[e[t]]>n[e[o]]&&xn(e,t,o);const s=e[o],a=n[s];for(;;){do o++;while(n[e[o]]<a);do l--;while(n[e[l]]>a);if(l<o)break;xn(e,o,l)}e[t+1]=e[l],e[l]=s,i-o+1>=l-t?(Mn(e,n,o,i),Mn(e,n,t,l-1)):(Mn(e,n,t,l-1),Mn(e,n,o,i))}}function xn(e,n,t){const i=e[n];e[n]=e[t],e[t]=i}function Li(e){return e[0]}function bi(e){return e[1]}const te=1e-6;class yn{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(n,t){this._+=`M${this._x0=this._x1=+n},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(n,t){this._+=`L${this._x1=+n},${this._y1=+t}`}arc(n,t,i){n=+n,t=+t,i=+i;const r=n+i,o=t;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${r},${o}`:(Math.abs(this._x1-r)>te||Math.abs(this._y1-o)>te)&&(this._+="L"+r+","+o),i&&(this._+=`A${i},${i},0,1,1,${n-i},${t}A${i},${i},0,1,1,${this._x1=r},${this._y1=o}`)}rect(n,t,i,r){this._+=`M${this._x0=this._x1=+n},${this._y0=this._y1=+t}h${+i}v${+r}h${-i}Z`}value(){return this._||null}}class St{constructor(){this._=[]}moveTo(n,t){this._.push([n,t])}closePath(){this._.push(this._[0].slice())}lineTo(n,t){this._.push([n,t])}value(){return this._.length?this._:null}}class ki{constructor(n,[t,i,r,o]=[0,0,960,500]){if(!((r=+r)>=(t=+t))||!((o=+o)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=n,this._circumcenters=new Float64Array(n.points.length*2),this.vectors=new Float64Array(n.points.length*2),this.xmax=r,this.xmin=t,this.ymax=o,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:n,hull:t,triangles:i},vectors:r}=this;let o,l;const s=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let d=0,y=0,v=i.length,w,E;d<v;d+=3,y+=2){const M=i[d]*2,P=i[d+1]*2,I=i[d+2]*2,A=n[M],C=n[M+1],_=n[P],x=n[P+1],S=n[I],T=n[I+1],z=_-A,N=x-C,m=S-A,$=T-C,F=(z*$-N*m)*2;if(Math.abs(F)<1e-9){if(o===void 0){o=l=0;for(const j of t)o+=n[j*2],l+=n[j*2+1];o/=t.length,l/=t.length}const D=1e9*Math.sign((o-A)*$-(l-C)*m);w=(A+S)/2-D*$,E=(C+T)/2+D*m}else{const D=1/F,j=z*z+N*N,Q=m*m+$*$;w=A+($*j-N*Q)*D,E=C+(z*Q-m*j)*D}s[y]=w,s[y+1]=E}let a=t[t.length-1],f,c=a*4,u,h=n[2*a],p,g=n[2*a+1];r.fill(0);for(let d=0;d<t.length;++d)a=t[d],f=c,u=h,p=g,c=a*4,h=n[2*a],g=n[2*a+1],r[f+2]=r[c]=p-g,r[f+3]=r[c+1]=h-u}render(n){const t=n==null?n=new yn:void 0,{delaunay:{halfedges:i,inedges:r,hull:o},circumcenters:l,vectors:s}=this;if(o.length<=1)return null;for(let c=0,u=i.length;c<u;++c){const h=i[c];if(h<c)continue;const p=Math.floor(c/3)*2,g=Math.floor(h/3)*2,d=l[p],y=l[p+1],v=l[g],w=l[g+1];this._renderSegment(d,y,v,w,n)}let a,f=o[o.length-1];for(let c=0;c<o.length;++c){a=f,f=o[c];const u=Math.floor(r[f]/3)*2,h=l[u],p=l[u+1],g=a*4,d=this._project(h,p,s[g+2],s[g+3]);d&&this._renderSegment(h,p,d[0],d[1],n)}return t&&t.value()}renderBounds(n){const t=n==null?n=new yn:void 0;return n.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(n,t){const i=t==null?t=new yn:void 0,r=this._clip(n);if(r===null||!r.length)return;t.moveTo(r[0],r[1]);let o=r.length;for(;r[0]===r[o-2]&&r[1]===r[o-1]&&o>1;)o-=2;for(let l=2;l<o;l+=2)(r[l]!==r[l-2]||r[l+1]!==r[l-1])&&t.lineTo(r[l],r[l+1]);return t.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:n}}=this;for(let t=0,i=n.length/2;t<i;++t){const r=this.cellPolygon(t);r&&(r.index=t,yield r)}}cellPolygon(n){const t=new St;return this.renderCell(n,t),t.value()}_renderSegment(n,t,i,r,o){let l;const s=this._regioncode(n,t),a=this._regioncode(i,r);s===0&&a===0?(o.moveTo(n,t),o.lineTo(i,r)):(l=this._clipSegment(n,t,i,r,s,a))&&(o.moveTo(l[0],l[1]),o.lineTo(l[2],l[3]))}contains(n,t,i){return t=+t,t!==t||(i=+i,i!==i)?!1:this.delaunay._step(n,t,i)===n}*neighbors(n){const t=this._clip(n);if(t)for(const i of this.delaunay.neighbors(n)){const r=this._clip(i);if(r){n:for(let o=0,l=t.length;o<l;o+=2)for(let s=0,a=r.length;s<a;s+=2)if(t[o]===r[s]&&t[o+1]===r[s+1]&&t[(o+2)%l]===r[(s+a-2)%a]&&t[(o+3)%l]===r[(s+a-1)%a]){yield i;break n}}}}_cell(n){const{circumcenters:t,delaunay:{inedges:i,halfedges:r,triangles:o}}=this,l=i[n];if(l===-1)return null;const s=[];let a=l;do{const f=Math.floor(a/3);if(s.push(t[f*2],t[f*2+1]),a=a%3===2?a-2:a+1,o[a]!==n)break;a=r[a]}while(a!==l&&a!==-1);return s}_clip(n){if(n===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(n);if(t===null)return null;const{vectors:i}=this,r=n*4;return this._simplify(i[r]||i[r+1]?this._clipInfinite(n,t,i[r],i[r+1],i[r+2],i[r+3]):this._clipFinite(n,t))}_clipFinite(n,t){const i=t.length;let r=null,o,l,s=t[i-2],a=t[i-1],f,c=this._regioncode(s,a),u,h=0;for(let p=0;p<i;p+=2)if(o=s,l=a,s=t[p],a=t[p+1],f=c,c=this._regioncode(s,a),f===0&&c===0)u=h,h=0,r?r.push(s,a):r=[s,a];else{let g,d,y,v,w;if(f===0){if((g=this._clipSegment(o,l,s,a,f,c))===null)continue;[d,y,v,w]=g}else{if((g=this._clipSegment(s,a,o,l,c,f))===null)continue;[v,w,d,y]=g,u=h,h=this._edgecode(d,y),u&&h&&this._edge(n,u,h,r,r.length),r?r.push(d,y):r=[d,y]}u=h,h=this._edgecode(v,w),u&&h&&this._edge(n,u,h,r,r.length),r?r.push(v,w):r=[v,w]}if(r)u=h,h=this._edgecode(r[0],r[1]),u&&h&&this._edge(n,u,h,r,r.length);else if(this.contains(n,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return r}_clipSegment(n,t,i,r,o,l){const s=o<l;for(s&&([n,t,i,r,o,l]=[i,r,n,t,l,o]);;){if(o===0&&l===0)return s?[i,r,n,t]:[n,t,i,r];if(o&l)return null;let a,f,c=o||l;c&8?(a=n+(i-n)*(this.ymax-t)/(r-t),f=this.ymax):c&4?(a=n+(i-n)*(this.ymin-t)/(r-t),f=this.ymin):c&2?(f=t+(r-t)*(this.xmax-n)/(i-n),a=this.xmax):(f=t+(r-t)*(this.xmin-n)/(i-n),a=this.xmin),o?(n=a,t=f,o=this._regioncode(n,t)):(i=a,r=f,l=this._regioncode(i,r))}}_clipInfinite(n,t,i,r,o,l){let s=Array.from(t),a;if((a=this._project(s[0],s[1],i,r))&&s.unshift(a[0],a[1]),(a=this._project(s[s.length-2],s[s.length-1],o,l))&&s.push(a[0],a[1]),s=this._clipFinite(n,s))for(let f=0,c=s.length,u,h=this._edgecode(s[c-2],s[c-1]);f<c;f+=2)u=h,h=this._edgecode(s[f],s[f+1]),u&&h&&(f=this._edge(n,u,h,s,f),c=s.length);else this.contains(n,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(s=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return s}_edge(n,t,i,r,o){for(;t!==i;){let l,s;switch(t){case 5:t=4;continue;case 4:t=6,l=this.xmax,s=this.ymin;break;case 6:t=2;continue;case 2:t=10,l=this.xmax,s=this.ymax;break;case 10:t=8;continue;case 8:t=9,l=this.xmin,s=this.ymax;break;case 9:t=1;continue;case 1:t=5,l=this.xmin,s=this.ymin;break}(r[o]!==l||r[o+1]!==s)&&this.contains(n,l,s)&&(r.splice(o,0,l,s),o+=2)}return o}_project(n,t,i,r){let o=1/0,l,s,a;if(r<0){if(t<=this.ymin)return null;(l=(this.ymin-t)/r)<o&&(a=this.ymin,s=n+(o=l)*i)}else if(r>0){if(t>=this.ymax)return null;(l=(this.ymax-t)/r)<o&&(a=this.ymax,s=n+(o=l)*i)}if(i>0){if(n>=this.xmax)return null;(l=(this.xmax-n)/i)<o&&(s=this.xmax,a=t+(o=l)*r)}else if(i<0){if(n<=this.xmin)return null;(l=(this.xmin-n)/i)<o&&(s=this.xmin,a=t+(o=l)*r)}return[s,a]}_edgecode(n,t){return(n===this.xmin?1:n===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(n,t){return(n<this.xmin?1:n>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}_simplify(n){if(n&&n.length>4){for(let t=0;t<n.length;t+=2){const i=(t+2)%n.length,r=(t+4)%n.length;(n[t]===n[i]&&n[i]===n[r]||n[t+1]===n[i+1]&&n[i+1]===n[r+1])&&(n.splice(i,2),t-=2)}n.length||(n=null)}return n}}const Ri=2*Math.PI,Sn=Math.pow;function ji(e){return e[0]}function Di(e){return e[1]}function qi(e){const{triangles:n,coords:t}=e;for(let i=0;i<n.length;i+=3){const r=2*n[i],o=2*n[i+1],l=2*n[i+2];if((t[l]-t[r])*(t[o+1]-t[r+1])-(t[o]-t[r])*(t[l+1]-t[r+1])>1e-10)return!1}return!0}function Gi(e,n,t){return[e+Math.sin(e+n)*t,n+Math.cos(e-n)*t]}class jt{static from(n,t=ji,i=Di,r){return new jt("length"in n?Hi(n,t,i,r):Float64Array.from(Ki(n,t,i,r)))}constructor(n){this._delaunator=new nt(n),this.inedges=new Int32Array(n.length/2),this._hullIndex=new Int32Array(n.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const n=this._delaunator,t=this.points;if(n.hull&&n.hull.length>2&&qi(n)){this.collinear=Int32Array.from({length:t.length/2},(h,p)=>p).sort((h,p)=>t[2*h]-t[2*p]||t[2*h+1]-t[2*p+1]);const a=this.collinear[0],f=this.collinear[this.collinear.length-1],c=[t[2*a],t[2*a+1],t[2*f],t[2*f+1]],u=1e-8*Math.hypot(c[3]-c[1],c[2]-c[0]);for(let h=0,p=t.length/2;h<p;++h){const g=Gi(t[2*h],t[2*h+1],u);t[2*h]=g[0],t[2*h+1]=g[1]}this._delaunator=new nt(t)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,o=this.triangles=this._delaunator.triangles,l=this.inedges.fill(-1),s=this._hullIndex.fill(-1);for(let a=0,f=i.length;a<f;++a){const c=o[a%3===2?a-2:a+1];(i[a]===-1||l[c]===-1)&&(l[c]=a)}for(let a=0,f=r.length;a<f;++a)s[r[a]]=a;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],l[r[0]]=1,r.length===2&&(l[r[1]]=0,this.triangles[1]=r[1],this.triangles[2]=r[1]))}voronoi(n){return new ki(this,n)}*neighbors(n){const{inedges:t,hull:i,_hullIndex:r,halfedges:o,triangles:l,collinear:s}=this;if(s){const u=s.indexOf(n);u>0&&(yield s[u-1]),u<s.length-1&&(yield s[u+1]);return}const a=t[n];if(a===-1)return;let f=a,c=-1;do{if(yield c=l[f],f=f%3===2?f-2:f+1,l[f]!==n)return;if(f=o[f],f===-1){const u=i[(r[n]+1)%i.length];u!==c&&(yield u);return}}while(f!==a)}find(n,t,i=0){if(n=+n,n!==n||(t=+t,t!==t))return-1;const r=i;let o;for(;(o=this._step(i,n,t))>=0&&o!==i&&o!==r;)i=o;return o}_step(n,t,i){const{inedges:r,hull:o,_hullIndex:l,halfedges:s,triangles:a,points:f}=this;if(r[n]===-1||!f.length)return(n+1)%(f.length>>1);let c=n,u=Sn(t-f[n*2],2)+Sn(i-f[n*2+1],2);const h=r[n];let p=h;do{let g=a[p];const d=Sn(t-f[g*2],2)+Sn(i-f[g*2+1],2);if(d<u&&(u=d,c=g),p=p%3===2?p-2:p+1,a[p]!==n)break;if(p=s[p],p===-1){if(p=o[(l[n]+1)%o.length],p!==g&&Sn(t-f[p*2],2)+Sn(i-f[p*2+1],2)<u)return p;break}}while(p!==h);return c}render(n){const t=n==null?n=new yn:void 0,{points:i,halfedges:r,triangles:o}=this;for(let l=0,s=r.length;l<s;++l){const a=r[l];if(a<l)continue;const f=o[l]*2,c=o[a]*2;n.moveTo(i[f],i[f+1]),n.lineTo(i[c],i[c+1])}return this.renderHull(n),t&&t.value()}renderPoints(n,t){t===void 0&&(!n||typeof n.moveTo!="function")&&(t=n,n=null),t=t==null?2:+t;const i=n==null?n=new yn:void 0,{points:r}=this;for(let o=0,l=r.length;o<l;o+=2){const s=r[o],a=r[o+1];n.moveTo(s+t,a),n.arc(s,a,t,0,Ri)}return i&&i.value()}renderHull(n){const t=n==null?n=new yn:void 0,{hull:i,points:r}=this,o=i[0]*2,l=i.length;n.moveTo(r[o],r[o+1]);for(let s=1;s<l;++s){const a=2*i[s];n.lineTo(r[a],r[a+1])}return n.closePath(),t&&t.value()}hullPolygon(){const n=new St;return this.renderHull(n),n.value()}renderTriangle(n,t){const i=t==null?t=new yn:void 0,{points:r,triangles:o}=this,l=o[n*=3]*2,s=o[n+1]*2,a=o[n+2]*2;return t.moveTo(r[l],r[l+1]),t.lineTo(r[s],r[s+1]),t.lineTo(r[a],r[a+1]),t.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:n}=this;for(let t=0,i=n.length/3;t<i;++t)yield this.trianglePolygon(t)}trianglePolygon(n){const t=new St;return this.renderTriangle(n,t),t.value()}}function Hi(e,n,t,i){const r=e.length,o=new Float64Array(r*2);for(let l=0;l<r;++l){const s=e[l];o[l*2]=n.call(i,s,l,e),o[l*2+1]=t.call(i,s,l,e)}return o}function*Ki(e,n,t,i){let r=0;for(const o of e)yield n.call(i,o,r,e),yield t.call(i,o,r,e),++r}var q=1e-6,Mt=1e-12,R=Math.PI,tn=R/2,ee=R/4,ln=R*2,Y=180/R,k=R/180,G=Math.abs,qe=Math.atan,gn=Math.atan2,L=Math.cos,Et=Math.hypot,b=Math.sin,Xi=Math.sign||function(e){return e>0?1:e<0?-1:0},vn=Math.sqrt;function Yi(e){return e>1?0:e<-1?R:Math.acos(e)}function dn(e){return e>1?tn:e<-1?-tn:Math.asin(e)}function nn(){}function tt(e,n){e&&re.hasOwnProperty(e.type)&&re[e.type](e,n)}var ie={Feature:function(e,n){tt(e.geometry,n)},FeatureCollection:function(e,n){for(var t=e.features,i=-1,r=t.length;++i<r;)tt(t[i].geometry,n)}},re={Sphere:function(e,n){n.sphere()},Point:function(e,n){e=e.coordinates,n.point(e[0],e[1],e[2])},MultiPoint:function(e,n){for(var t=e.coordinates,i=-1,r=t.length;++i<r;)e=t[i],n.point(e[0],e[1],e[2])},LineString:function(e,n){$t(e.coordinates,n,0)},MultiLineString:function(e,n){for(var t=e.coordinates,i=-1,r=t.length;++i<r;)$t(t[i],n,0)},Polygon:function(e,n){oe(e.coordinates,n)},MultiPolygon:function(e,n){for(var t=e.coordinates,i=-1,r=t.length;++i<r;)oe(t[i],n)},GeometryCollection:function(e,n){for(var t=e.geometries,i=-1,r=t.length;++i<r;)tt(t[i],n)}};function $t(e,n,t){var i=-1,r=e.length-t,o;for(n.lineStart();++i<r;)o=e[i],n.point(o[0],o[1],o[2]);n.lineEnd()}function oe(e,n){var t=-1,i=e.length;for(n.polygonStart();++t<i;)$t(e[t],n,1);n.polygonEnd()}function Dt(e,n){e&&ie.hasOwnProperty(e.type)?ie[e.type](e,n):tt(e,n)}function Pt(e){return[gn(e[1],e[0]),dn(e[2])]}function En(e){var n=e[0],t=e[1],i=L(t);return[i*L(n),i*b(n),b(t)]}function Dn(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]}function et(e,n){return[e[1]*n[2]-e[2]*n[1],e[2]*n[0]-e[0]*n[2],e[0]*n[1]-e[1]*n[0]]}function mt(e,n){e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}function qn(e,n){return[e[0]*n,e[1]*n,e[2]*n]}function xt(e){var n=vn(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=n,e[1]/=n,e[2]/=n}var Cn,it,rt,ot,lt,st,ut,ct,It,Ct,At,Ge,He,Z,W,V,on={sphere:nn,point:qt,lineStart:le,lineEnd:se,polygonStart:function(){on.lineStart=Ui,on.lineEnd=Zi},polygonEnd:function(){on.lineStart=le,on.lineEnd=se}};function qt(e,n){e*=k,n*=k;var t=L(n);bn(t*L(e),t*b(e),b(n))}function bn(e,n,t){++Cn,rt+=(e-rt)/Cn,ot+=(n-ot)/Cn,lt+=(t-lt)/Cn}function le(){on.point=Bi}function Bi(e,n){e*=k,n*=k;var t=L(n);Z=t*L(e),W=t*b(e),V=b(n),on.point=Oi,bn(Z,W,V)}function Oi(e,n){e*=k,n*=k;var t=L(n),i=t*L(e),r=t*b(e),o=b(n),l=gn(vn((l=W*o-V*r)*l+(l=V*i-Z*o)*l+(l=Z*r-W*i)*l),Z*i+W*r+V*o);it+=l,st+=l*(Z+(Z=i)),ut+=l*(W+(W=r)),ct+=l*(V+(V=o)),bn(Z,W,V)}function se(){on.point=qt}function Ui(){on.point=Wi}function Zi(){Ke(Ge,He),on.point=qt}function Wi(e,n){Ge=e,He=n,e*=k,n*=k,on.point=Ke;var t=L(n);Z=t*L(e),W=t*b(e),V=b(n),bn(Z,W,V)}function Ke(e,n){e*=k,n*=k;var t=L(n),i=t*L(e),r=t*b(e),o=b(n),l=W*o-V*r,s=V*i-Z*o,a=Z*r-W*i,f=Et(l,s,a),c=dn(f),u=f&&-c/f;It.add(u*l),Ct.add(u*s),At.add(u*a),it+=c,st+=c*(Z+(Z=i)),ut+=c*(W+(W=r)),ct+=c*(V+(V=o)),bn(Z,W,V)}function ue(e){Cn=it=rt=ot=lt=st=ut=ct=0,It=new Nn,Ct=new Nn,At=new Nn,Dt(e,on);var n=+It,t=+Ct,i=+At,r=Et(n,t,i);return r<Mt&&(n=st,t=ut,i=ct,it<q&&(n=rt,t=ot,i=lt),r=Et(n,t,i),r<Mt)?[NaN,NaN]:[gn(t,n)*Y,dn(i/r)*Y]}function Nt(e,n){function t(i,r){return i=e(i,r),n(i[0],i[1])}return e.invert&&n.invert&&(t.invert=function(i,r){return i=n.invert(i,r),i&&e.invert(i[0],i[1])}),t}function Tt(e,n){return G(e)>R&&(e-=Math.round(e/ln)*ln),[e,n]}Tt.invert=Tt;function Xe(e,n,t){return(e%=ln)?n||t?Nt(ae(e),fe(n,t)):ae(e):n||t?fe(n,t):Tt}function ce(e){return function(n,t){return n+=e,G(n)>R&&(n-=Math.round(n/ln)*ln),[n,t]}}function ae(e){var n=ce(e);return n.invert=ce(-e),n}function fe(e,n){var t=L(e),i=b(e),r=L(n),o=b(n);function l(s,a){var f=L(a),c=L(s)*f,u=b(s)*f,h=b(a),p=h*t+c*i;return[gn(u*r-p*o,c*t-h*i),dn(p*r+u*o)]}return l.invert=function(s,a){var f=L(a),c=L(s)*f,u=b(s)*f,h=b(a),p=h*r-u*o;return[gn(u*r+h*o,c*t+p*i),dn(p*t-c*i)]},l}function Vi(e){e=Xe(e[0]*k,e[1]*k,e.length>2?e[2]*k:0);function n(t){return t=e(t[0]*k,t[1]*k),t[0]*=Y,t[1]*=Y,t}return n.invert=function(t){return t=e.invert(t[0]*k,t[1]*k),t[0]*=Y,t[1]*=Y,t},n}function Ji(e,n,t,i,r,o){if(t){var l=L(n),s=b(n),a=i*t;r==null?(r=n+i*ln,o=n-a/2):(r=he(l,r),o=he(l,o),(i>0?r<o:r>o)&&(r+=i*ln));for(var f,c=r;i>0?c>o:c<o;c-=a)f=Pt([l,-s*L(c),-s*b(c)]),e.point(f[0],f[1])}}function he(e,n){n=En(n),n[0]-=e,xt(n);var t=Yi(-n[1]);return((-n[2]<0?-t:t)+ln-q)%ln}function Ye(){var e=[],n;return{point:function(t,i,r){n.push([t,i,r])},lineStart:function(){e.push(n=[])},lineEnd:nn,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var t=e;return e=[],n=null,t}}}function Xn(e,n){return G(e[0]-n[0])<q&&G(e[1]-n[1])<q}function Gn(e,n,t,i){this.x=e,this.z=n,this.o=t,this.e=i,this.v=!1,this.n=this.p=null}function Be(e,n,t,i,r){var o=[],l=[],s,a;if(e.forEach(function(g){if(!((d=g.length-1)<=0)){var d,y=g[0],v=g[d],w;if(Xn(y,v)){if(!y[2]&&!v[2]){for(r.lineStart(),s=0;s<d;++s)r.point((y=g[s])[0],y[1]);r.lineEnd();return}v[0]+=2*q}o.push(w=new Gn(y,g,null,!0)),l.push(w.o=new Gn(y,null,w,!1)),o.push(w=new Gn(v,g,null,!1)),l.push(w.o=new Gn(v,null,w,!0))}}),!!o.length){for(l.sort(n),pe(o),pe(l),s=0,a=l.length;s<a;++s)l[s].e=t=!t;for(var f=o[0],c,u;;){for(var h=f,p=!0;h.v;)if((h=h.n)===f)return;c=h.z,r.lineStart();do{if(h.v=h.o.v=!0,h.e){if(p)for(s=0,a=c.length;s<a;++s)r.point((u=c[s])[0],u[1]);else i(h.x,h.n.x,1,r);h=h.n}else{if(p)for(c=h.p.z,s=c.length-1;s>=0;--s)r.point((u=c[s])[0],u[1]);else i(h.x,h.p.x,-1,r);h=h.p}h=h.o,c=h.z,p=!p}while(!h.v);r.lineEnd()}}}function pe(e){if(n=e.length){for(var n,t=0,i=e[0],r;++t<n;)i.n=r=e[t],r.p=i,i=r;i.n=r=e[0],r.p=i}}function yt(e){return G(e[0])<=R?e[0]:Xi(e[0])*((G(e[0])+R)%ln-R)}function Qi(e,n){var t=yt(n),i=n[1],r=b(i),o=[b(t),-L(t),0],l=0,s=0,a=new Nn;r===1?i=tn+q:r===-1&&(i=-tn-q);for(var f=0,c=e.length;f<c;++f)if(h=(u=e[f]).length)for(var u,h,p=u[h-1],g=yt(p),d=p[1]/2+ee,y=b(d),v=L(d),w=0;w<h;++w,g=M,y=I,v=A,p=E){var E=u[w],M=yt(E),P=E[1]/2+ee,I=b(P),A=L(P),C=M-g,_=C>=0?1:-1,x=_*C,S=x>R,T=y*I;if(a.add(gn(T*_*b(x),v*A+T*L(x))),l+=S?C+_*ln:C,S^g>=t^M>=t){var z=et(En(p),En(E));xt(z);var N=et(o,z);xt(N);var m=(S^C>=0?-1:1)*dn(N[2]);(i>m||i===m&&(z[0]||z[1]))&&(s+=S^C>=0?1:-1)}}return(l<-q||l<q&&a<-Mt)^s&1}function Oe(e,n,t,i){return function(r){var o=n(r),l=Ye(),s=n(l),a=!1,f,c,u,h={point:p,lineStart:d,lineEnd:y,polygonStart:function(){h.point=v,h.lineStart=w,h.lineEnd=E,c=[],f=[]},polygonEnd:function(){h.point=p,h.lineStart=d,h.lineEnd=y,c=Le(c);var M=Qi(f,i);c.length?(a||(r.polygonStart(),a=!0),Be(c,tr,M,t,r)):M&&(a||(r.polygonStart(),a=!0),r.lineStart(),t(null,null,1,r),r.lineEnd()),a&&(r.polygonEnd(),a=!1),c=f=null},sphere:function(){r.polygonStart(),r.lineStart(),t(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function p(M,P){e(M,P)&&r.point(M,P)}function g(M,P){o.point(M,P)}function d(){h.point=g,o.lineStart()}function y(){h.point=p,o.lineEnd()}function v(M,P){u.push([M,P]),s.point(M,P)}function w(){s.lineStart(),u=[]}function E(){v(u[0][0],u[0][1]),s.lineEnd();var M=s.clean(),P=l.result(),I,A=P.length,C,_,x;if(u.pop(),f.push(u),u=null,!!A){if(M&1){if(_=P[0],(C=_.length-1)>0){for(a||(r.polygonStart(),a=!0),r.lineStart(),I=0;I<C;++I)r.point((x=_[I])[0],x[1]);r.lineEnd()}return}A>1&&M&2&&P.push(P.pop().concat(P.shift())),c.push(P.filter(nr))}}return h}}function nr(e){return e.length>1}function tr(e,n){return((e=e.x)[0]<0?e[1]-tn-q:tn-e[1])-((n=n.x)[0]<0?n[1]-tn-q:tn-n[1])}const ge=Oe(function(){return!0},er,rr,[-R,-tn]);function er(e){var n=NaN,t=NaN,i=NaN,r;return{lineStart:function(){e.lineStart(),r=1},point:function(o,l){var s=o>0?R:-R,a=G(o-n);G(a-R)<q?(e.point(n,t=(t+l)/2>0?tn:-tn),e.point(i,t),e.lineEnd(),e.lineStart(),e.point(s,t),e.point(o,t),r=0):i!==s&&a>=R&&(G(n-i)<q&&(n-=i*q),G(o-s)<q&&(o-=s*q),t=ir(n,t,o,l),e.point(i,t),e.lineEnd(),e.lineStart(),e.point(s,t),r=0),e.point(n=o,t=l),i=s},lineEnd:function(){e.lineEnd(),n=t=NaN},clean:function(){return 2-r}}}function ir(e,n,t,i){var r,o,l=b(e-t);return G(l)>q?qe((b(n)*(o=L(i))*b(t)-b(i)*(r=L(n))*b(e))/(r*o*l)):(n+i)/2}function rr(e,n,t,i){var r;if(e==null)r=t*tn,i.point(-R,r),i.point(0,r),i.point(R,r),i.point(R,0),i.point(R,-r),i.point(0,-r),i.point(-R,-r),i.point(-R,0),i.point(-R,r);else if(G(e[0]-n[0])>q){var o=e[0]<n[0]?R:-R;r=t*o/2,i.point(-o,r),i.point(0,r),i.point(o,r)}else i.point(n[0],n[1])}function or(e){var n=L(e),t=2*k,i=n>0,r=G(n)>q;function o(c,u,h,p){Ji(p,e,t,h,c,u)}function l(c,u){return L(c)*L(u)>n}function s(c){var u,h,p,g,d;return{lineStart:function(){g=p=!1,d=1},point:function(y,v){var w=[y,v],E,M=l(y,v),P=i?M?0:f(y,v):M?f(y+(y<0?R:-R),v):0;if(!u&&(g=p=M)&&c.lineStart(),M!==p&&(E=a(u,w),(!E||Xn(u,E)||Xn(w,E))&&(w[2]=1)),M!==p)d=0,M?(c.lineStart(),E=a(w,u),c.point(E[0],E[1])):(E=a(u,w),c.point(E[0],E[1],2),c.lineEnd()),u=E;else if(r&&u&&i^M){var I;!(P&h)&&(I=a(w,u,!0))&&(d=0,i?(c.lineStart(),c.point(I[0][0],I[0][1]),c.point(I[1][0],I[1][1]),c.lineEnd()):(c.point(I[1][0],I[1][1]),c.lineEnd(),c.lineStart(),c.point(I[0][0],I[0][1],3)))}M&&(!u||!Xn(u,w))&&c.point(w[0],w[1]),u=w,p=M,h=P},lineEnd:function(){p&&c.lineEnd(),u=null},clean:function(){return d|(g&&p)<<1}}}function a(c,u,h){var p=En(c),g=En(u),d=[1,0,0],y=et(p,g),v=Dn(y,y),w=y[0],E=v-w*w;if(!E)return!h&&c;var M=n*v/E,P=-n*w/E,I=et(d,y),A=qn(d,M),C=qn(y,P);mt(A,C);var _=I,x=Dn(A,_),S=Dn(_,_),T=x*x-S*(Dn(A,A)-1);if(!(T<0)){var z=vn(T),N=qn(_,(-x-z)/S);if(mt(N,A),N=Pt(N),!h)return N;var m=c[0],$=u[0],F=c[1],D=u[1],j;$<m&&(j=m,m=$,$=j);var Q=$-m,en=G(Q-R)<q,mn=en||Q<q;if(!en&&D<F&&(j=F,F=D,D=j),mn?en?F+D>0^N[1]<(G(N[0]-m)<q?F:D):F<=N[1]&&N[1]<=D:Q>R^(m<=N[0]&&N[0]<=$)){var hn=qn(_,(-x+z)/S);return mt(hn,A),[N,Pt(hn)]}}}function f(c,u){var h=i?e:R-e,p=0;return c<-h?p|=1:c>h&&(p|=2),u<-h?p|=4:u>h&&(p|=8),p}return Oe(l,s,o,i?[0,-e]:[-R,e-R])}function lr(e,n,t,i,r,o){var l=e[0],s=e[1],a=n[0],f=n[1],c=0,u=1,h=a-l,p=f-s,g;if(g=t-l,!(!h&&g>0)){if(g/=h,h<0){if(g<c)return;g<u&&(u=g)}else if(h>0){if(g>u)return;g>c&&(c=g)}if(g=r-l,!(!h&&g<0)){if(g/=h,h<0){if(g>u)return;g>c&&(c=g)}else if(h>0){if(g<c)return;g<u&&(u=g)}if(g=i-s,!(!p&&g>0)){if(g/=p,p<0){if(g<c)return;g<u&&(u=g)}else if(p>0){if(g>u)return;g>c&&(c=g)}if(g=o-s,!(!p&&g<0)){if(g/=p,p<0){if(g>u)return;g>c&&(c=g)}else if(p>0){if(g<c)return;g<u&&(u=g)}return c>0&&(e[0]=l+c*h,e[1]=s+c*p),u<1&&(n[0]=l+u*h,n[1]=s+u*p),!0}}}}}var An=1e9,Hn=-An;function sr(e,n,t,i){function r(f,c){return e<=f&&f<=t&&n<=c&&c<=i}function o(f,c,u,h){var p=0,g=0;if(f==null||(p=l(f,u))!==(g=l(c,u))||a(f,c)<0^u>0)do h.point(p===0||p===3?e:t,p>1?i:n);while((p=(p+u+4)%4)!==g);else h.point(c[0],c[1])}function l(f,c){return G(f[0]-e)<q?c>0?0:3:G(f[0]-t)<q?c>0?2:1:G(f[1]-n)<q?c>0?1:0:c>0?3:2}function s(f,c){return a(f.x,c.x)}function a(f,c){var u=l(f,1),h=l(c,1);return u!==h?u-h:u===0?c[1]-f[1]:u===1?f[0]-c[0]:u===2?f[1]-c[1]:c[0]-f[0]}return function(f){var c=f,u=Ye(),h,p,g,d,y,v,w,E,M,P,I,A={point:C,lineStart:T,lineEnd:z,polygonStart:x,polygonEnd:S};function C(m,$){r(m,$)&&c.point(m,$)}function _(){for(var m=0,$=0,F=p.length;$<F;++$)for(var D=p[$],j=1,Q=D.length,en=D[0],mn,hn,kn=en[0],_n=en[1];j<Q;++j)mn=kn,hn=_n,en=D[j],kn=en[0],_n=en[1],hn<=i?_n>i&&(kn-mn)*(i-hn)>(_n-hn)*(e-mn)&&++m:_n<=i&&(kn-mn)*(i-hn)<(_n-hn)*(e-mn)&&--m;return m}function x(){c=u,h=[],p=[],I=!0}function S(){var m=_(),$=I&&m,F=(h=Le(h)).length;($||F)&&(f.polygonStart(),$&&(f.lineStart(),o(null,null,1,f),f.lineEnd()),F&&Be(h,s,m,o,f),f.polygonEnd()),c=f,h=p=g=null}function T(){A.point=N,p&&p.push(g=[]),P=!0,M=!1,w=E=NaN}function z(){h&&(N(d,y),v&&M&&u.rejoin(),h.push(u.result())),A.point=C,M&&c.lineEnd()}function N(m,$){var F=r(m,$);if(p&&g.push([m,$]),P)d=m,y=$,v=F,P=!1,F&&(c.lineStart(),c.point(m,$));else if(F&&M)c.point(m,$);else{var D=[w=Math.max(Hn,Math.min(An,w)),E=Math.max(Hn,Math.min(An,E))],j=[m=Math.max(Hn,Math.min(An,m)),$=Math.max(Hn,Math.min(An,$))];lr(D,j,e,n,t,i)?(M||(c.lineStart(),c.point(D[0],D[1])),c.point(j[0],j[1]),F||c.lineEnd(),I=!1):F&&(c.lineStart(),c.point(m,$),I=!1)}w=m,E=$,M=F}return A}}var zt,Ft,Yn,Bn,$n={sphere:nn,point:nn,lineStart:ur,lineEnd:nn,polygonStart:nn,polygonEnd:nn};function ur(){$n.point=ar,$n.lineEnd=cr}function cr(){$n.point=$n.lineEnd=nn}function ar(e,n){e*=k,n*=k,Ft=e,Yn=b(n),Bn=L(n),$n.point=fr}function fr(e,n){e*=k,n*=k;var t=b(n),i=L(n),r=G(e-Ft),o=L(r),l=b(r),s=i*l,a=Bn*t-Yn*i*o,f=Yn*t+Bn*i*o;zt.add(gn(vn(s*s+a*a),f)),Ft=e,Yn=t,Bn=i}function hr(e){return zt=new Nn,Dt(e,$n),+zt}var Lt=[null,null],pr={type:"LineString",coordinates:Lt};function de(e,n){return Lt[0]=e,Lt[1]=n,hr(pr)}const me=e=>e;var Pn=1/0,at=Pn,zn=-Pn,ft=zn,gr={point:dr,lineStart:nn,lineEnd:nn,polygonStart:nn,polygonEnd:nn,result:function(){var e=[[Pn,at],[zn,ft]];return zn=ft=-(at=Pn=1/0),e}};function dr(e,n){e<Pn&&(Pn=e),e>zn&&(zn=e),n<at&&(at=n),n>ft&&(ft=n)}const ye=gr;function Gt(e){return function(n){var t=new bt;for(var i in e)t[i]=e[i];return t.stream=n,t}}function bt(){}bt.prototype={constructor:bt,point:function(e,n){this.stream.point(e,n)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Ht(e,n,t){var i=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),i!=null&&e.clipExtent(null),Dt(t,e.stream(ye)),n(ye.result()),i!=null&&e.clipExtent(i),e}function Ue(e,n,t){return Ht(e,function(i){var r=n[1][0]-n[0][0],o=n[1][1]-n[0][1],l=Math.min(r/(i[1][0]-i[0][0]),o/(i[1][1]-i[0][1])),s=+n[0][0]+(r-l*(i[1][0]+i[0][0]))/2,a=+n[0][1]+(o-l*(i[1][1]+i[0][1]))/2;e.scale(150*l).translate([s,a])},t)}function mr(e,n,t){return Ue(e,[[0,0],n],t)}function yr(e,n,t){return Ht(e,function(i){var r=+n,o=r/(i[1][0]-i[0][0]),l=(r-o*(i[1][0]+i[0][0]))/2,s=-o*i[0][1];e.scale(150*o).translate([l,s])},t)}function vr(e,n,t){return Ht(e,function(i){var r=+n,o=r/(i[1][1]-i[0][1]),l=-o*i[0][0],s=(r-o*(i[1][1]+i[0][1]))/2;e.scale(150*o).translate([l,s])},t)}var ve=16,_r=L(30*k);function _e(e,n){return+n?Sr(e,n):wr(e)}function wr(e){return Gt({point:function(n,t){n=e(n,t),this.stream.point(n[0],n[1])}})}function Sr(e,n){function t(i,r,o,l,s,a,f,c,u,h,p,g,d,y){var v=f-i,w=c-r,E=v*v+w*w;if(E>4*n&&d--){var M=l+h,P=s+p,I=a+g,A=vn(M*M+P*P+I*I),C=dn(I/=A),_=G(G(I)-1)<q||G(o-u)<q?(o+u)/2:gn(P,M),x=e(_,C),S=x[0],T=x[1],z=S-i,N=T-r,m=w*z-v*N;(m*m/E>n||G((v*z+w*N)/E-.5)>.3||l*h+s*p+a*g<_r)&&(t(i,r,o,l,s,a,S,T,_,M/=A,P/=A,I,d,y),y.point(S,T),t(S,T,_,M,P,I,f,c,u,h,p,g,d,y))}}return function(i){var r,o,l,s,a,f,c,u,h,p,g,d,y={point:v,lineStart:w,lineEnd:M,polygonStart:function(){i.polygonStart(),y.lineStart=P},polygonEnd:function(){i.polygonEnd(),y.lineStart=w}};function v(C,_){C=e(C,_),i.point(C[0],C[1])}function w(){u=NaN,y.point=E,i.lineStart()}function E(C,_){var x=En([C,_]),S=e(C,_);t(u,h,c,p,g,d,u=S[0],h=S[1],c=C,p=x[0],g=x[1],d=x[2],ve,i),i.point(u,h)}function M(){y.point=v,i.lineEnd()}function P(){w(),y.point=I,y.lineEnd=A}function I(C,_){E(r=C,_),o=u,l=h,s=p,a=g,f=d,y.point=E}function A(){t(u,h,c,p,g,d,o,l,r,s,a,f,ve,i),y.lineEnd=M,M()}return y}}var Mr=Gt({point:function(e,n){this.stream.point(e*k,n*k)}});function Er(e){return Gt({point:function(n,t){var i=e(n,t);return this.stream.point(i[0],i[1])}})}function $r(e,n,t,i,r){function o(l,s){return l*=i,s*=r,[n+e*l,t-e*s]}return o.invert=function(l,s){return[(l-n)/e*i,(t-s)/e*r]},o}function we(e,n,t,i,r,o){if(!o)return $r(e,n,t,i,r);var l=L(o),s=b(o),a=l*e,f=s*e,c=l/e,u=s/e,h=(s*t-l*n)/e,p=(s*n+l*t)/e;function g(d,y){return d*=i,y*=r,[a*d-f*y+n,t-f*d-a*y]}return g.invert=function(d,y){return[i*(c*d-u*y+h),r*(p-u*d-c*y)]},g}function Pr(e){return xr(function(){return e})()}function xr(e){var n,t=150,i=480,r=250,o=0,l=0,s=0,a=0,f=0,c,u=0,h=1,p=1,g=null,d=ge,y=null,v,w,E,M=me,P=.5,I,A,C,_,x;function S(m){return C(m[0]*k,m[1]*k)}function T(m){return m=C.invert(m[0],m[1]),m&&[m[0]*Y,m[1]*Y]}S.stream=function(m){return _&&x===m?_:_=Mr(Er(c)(d(I(M(x=m)))))},S.preclip=function(m){return arguments.length?(d=m,g=void 0,N()):d},S.postclip=function(m){return arguments.length?(M=m,y=v=w=E=null,N()):M},S.clipAngle=function(m){return arguments.length?(d=+m?or(g=m*k):(g=null,ge),N()):g*Y},S.clipExtent=function(m){return arguments.length?(M=m==null?(y=v=w=E=null,me):sr(y=+m[0][0],v=+m[0][1],w=+m[1][0],E=+m[1][1]),N()):y==null?null:[[y,v],[w,E]]},S.scale=function(m){return arguments.length?(t=+m,z()):t},S.translate=function(m){return arguments.length?(i=+m[0],r=+m[1],z()):[i,r]},S.center=function(m){return arguments.length?(o=m[0]%360*k,l=m[1]%360*k,z()):[o*Y,l*Y]},S.rotate=function(m){return arguments.length?(s=m[0]%360*k,a=m[1]%360*k,f=m.length>2?m[2]%360*k:0,z()):[s*Y,a*Y,f*Y]},S.angle=function(m){return arguments.length?(u=m%360*k,z()):u*Y},S.reflectX=function(m){return arguments.length?(h=m?-1:1,z()):h<0},S.reflectY=function(m){return arguments.length?(p=m?-1:1,z()):p<0},S.precision=function(m){return arguments.length?(I=_e(A,P=m*m),N()):vn(P)},S.fitExtent=function(m,$){return Ue(S,m,$)},S.fitSize=function(m,$){return mr(S,m,$)},S.fitWidth=function(m,$){return yr(S,m,$)},S.fitHeight=function(m,$){return vr(S,m,$)};function z(){var m=we(t,0,0,h,p,u).apply(null,n(o,l)),$=we(t,i-m[0],r-m[1],h,p,u);return c=Xe(s,a,f),A=Nt(n,$),C=Nt(c,A),I=_e(A,P),N()}function N(){return _=x=null,S}return function(){return n=e.apply(this,arguments),S.invert=n.invert&&T,z()}}function Ir(e){return function(n,t){var i=vn(n*n+t*t),r=e(i),o=b(r),l=L(r);return[gn(n*o,i*l),dn(i&&t*o/i)]}}function Ze(e,n){var t=L(n),i=1+L(e)*t;return[t*b(e)/i,b(n)/i]}Ze.invert=Ir(function(e){return 2*qe(e)});function Cr(){return Pr(Ze).scale(250).clipAngle(142)}const Kt=Math.PI,Se=Kt/2,Me=180/Kt,Ee=Kt/180,Ar=Math.atan2,$e=Math.cos,Nr=Math.max,Tr=Math.min,Pe=Math.sin,zr=Math.sign||function(e){return e>0?1:e<0?-1:0},We=Math.sqrt;function Fr(e){return e>1?Se:e<-1?-Se:Math.asin(e)}function Ve(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]}function J(e,n){return[e[1]*n[2]-e[2]*n[1],e[2]*n[0]-e[0]*n[2],e[0]*n[1]-e[1]*n[0]]}function ht(e,n){return[e[0]+n[0],e[1]+n[1],e[2]+n[2]]}function pt(e){var n=We(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/n,e[1]/n,e[2]/n]}function Xt(e){return[Ar(e[1],e[0])*Me,Fr(Nr(-1,Tr(1,e[2])))*Me]}function un(e){const n=e[0]*Ee,t=e[1]*Ee,i=$e(t);return[i*$e(n),i*Pe(n),Pe(t)]}function Yt(e){return e=e.map(n=>un(n)),Ve(e[0],J(e[2],e[1]))}function Lr(e){const n=kr(e),t=jr(n),i=Rr(t,e),r=qr(t,e.length),o=br(r,e),l=Dr(t,e),{polygons:s,centers:a}=Gr(l,t,e),f=Hr(s),c=Xr(t,e),u=Kr(i,t);return{delaunay:n,edges:i,triangles:t,centers:a,neighbors:r,polygons:s,mesh:f,hull:c,urquhart:u,find:o}}function br(e,n){function t(i,r){let o=i[0]-r[0],l=i[1]-r[1],s=i[2]-r[2];return o*o+l*l+s*s}return function(r,o,l){l===void 0&&(l=0);let s,a,f=l;const c=un([r,o]);do s=l,l=null,a=t(c,un(n[s])),e[s].forEach(u=>{let h=t(c,un(n[u]));if(h<a){a=h,l=u,f=u;return}});while(l!==null);return f}}function kr(e){if(e.length<2)return{};let n=0;for(;isNaN(e[n][0]+e[n][1])&&n++<e.length;);const t=Vi(e[n]),i=Cr().translate([0,0]).scale(1).rotate(t.invert([180,0]));e=e.map(i);const r=[];let o=1;for(let u=0,h=e.length;u<h;u++){let p=e[u][0]**2+e[u][1]**2;!isFinite(p)||p>1e32?r.push(u):p>o&&(o=p)}const l=1e6*We(o);r.forEach(u=>e[u]=[l,0]),e.push([0,l]),e.push([-l,0]),e.push([0,-l]);const s=jt.from(e);s.projection=i;const{triangles:a,halfedges:f,inedges:c}=s;for(let u=0,h=f.length;u<h;u++)if(f[u]<0){const p=u%3==2?u-2:u+1,g=u%3==0?u+2:u-1,d=f[p],y=f[g];f[d]=y,f[y]=d,f[p]=f[g]=-1,a[u]=a[p]=a[g]=n,c[a[d]]=d%3==0?d+2:d-1,c[a[y]]=y%3==0?y+2:y-1,u+=2-u%3}else a[u]>e.length-3-1&&(a[u]=n);return s}function Rr(e,n){const t=new Set;return n.length===2?[[0,1]]:(e.forEach(i=>{if(i[0]!==i[1]&&!(Yt(i.map(r=>n[r]))<0))for(let r=0,o;r<3;r++)o=(r+1)%3,t.add(Fe([i[r],i[o]]).join("-"))}),Array.from(t,i=>i.split("-").map(Number)))}function jr(e){const{triangles:n}=e;if(!n)return[];const t=[];for(let i=0,r=n.length/3;i<r;i++){const o=n[3*i],l=n[3*i+1],s=n[3*i+2];o!==l&&l!==s&&t.push([o,s,l])}return t}function Dr(e,n){return e.map(t=>{const i=t.map(o=>n[o]).map(un),r=ht(ht(J(i[1],i[0]),J(i[2],i[1])),J(i[0],i[2]));return Xt(pt(r))})}function qr(e,n){const t=[];return e.forEach(i=>{for(let r=0;r<3;r++){const o=i[r],l=i[(r+1)%3];t[o]=t[o]||[],t[o].push(l)}}),e.length===0&&(n===2?(t[0]=[1],t[1]=[0]):n===1&&(t[0]=[])),t}function Gr(e,n,t){const i=[],r=e.slice();if(n.length===0){if(t.length<2)return{polygons:i,centers:r};if(t.length===2){const s=un(t[0]),a=un(t[1]),f=pt(ht(s,a)),c=pt(J(s,a)),u=J(f,c),h=[f,J(f,u),J(J(f,u),u),J(J(J(f,u),u),u)].map(Xt).map(l);return i.push(h),i.push(h.slice().reverse()),{polygons:i,centers:r}}}n.forEach((s,a)=>{for(let f=0;f<3;f++){const c=s[f],u=s[(f+1)%3],h=s[(f+2)%3];i[c]=i[c]||[],i[c].push([u,h,a,[c,u,h]])}});const o=i.map(s=>{const a=[s[0][2]];let f=s[0][1];for(let c=1;c<s.length;c++)for(let u=0;u<s.length;u++)if(s[u][0]==f){f=s[u][1],a.push(s[u][2]);break}if(a.length>2)return a;if(a.length==2){const c=xe(t[s[0][3][0]],t[s[0][3][1]],r[a[0]]),u=xe(t[s[0][3][2]],t[s[0][3][0]],r[a[0]]),h=l(c),p=l(u);return[a[0],p,a[1],h]}});function l(s){let a=-1;return r.slice(n.length,1/0).forEach((f,c)=>{f[0]===s[0]&&f[1]===s[1]&&(a=c+n.length)}),a<0&&(a=r.length,r.push(s)),a}return{polygons:o,centers:r}}function xe(e,n,t){e=un(e),n=un(n),t=un(t);const i=zr(Ve(J(n,e),t));return Xt(pt(ht(e,n)).map(r=>i*r))}function Hr(e){const n=[];return e.forEach(t=>{if(!t)return;let i=t[t.length-1];for(let r of t)r>i&&n.push([i,r]),i=r}),n}function Kr(e,n){return function(t){const i=new Map,r=new Map;return e.forEach((o,l)=>{const s=o.join("-");i.set(s,t[l]),r.set(s,!0)}),n.forEach(o=>{let l=0,s=-1;for(let a=0;a<3;a++){let f=Fe([o[a],o[(a+1)%3]]).join("-");i.get(f)>l&&(l=i.get(f),s=f)}r.set(s,!1)}),e.map(o=>r.get(o.join("-")))}}function Xr(e,n){const t=new Set,i=[];e.map(s=>{if(!(Yt(s.map(a=>n[a>n.length?0:a]))>1e-12))for(let a=0;a<3;a++){let f=[s[a],s[(a+1)%3]],c=`${f[0]}-${f[1]}`;t.has(c)?t.delete(c):t.add(`${f[1]}-${f[0]}`)}});const r=new Map;let o;if(t.forEach(s=>{s=s.split("-").map(Number),r.set(s[0],s[1]),o=s[0]}),o===void 0)return i;let l=o;do{i.push(l);let s=r.get(l);r.set(l,-1),l=s}while(l>-1&&l!==o);return i}function Yr(e){const n=function(t){if(n.delaunay=null,n._data=t,typeof n._data=="object"&&n._data.type==="FeatureCollection"&&(n._data=n._data.features),typeof n._data=="object"){const i=n._data.map(r=>[n._vx(r),n._vy(r),r]).filter(r=>isFinite(r[0]+r[1]));n.points=i.map(r=>[r[0],r[1]]),n.valid=i.map(r=>r[2]),n.delaunay=Lr(n.points)}return n};return n._vx=function(t){if(typeof t=="object"&&"type"in t)return ue(t)[0];if(0 in t)return t[0]},n._vy=function(t){if(typeof t=="object"&&"type"in t)return ue(t)[1];if(1 in t)return t[1]},n.x=function(t){return t?(n._vx=t,n):n._vx},n.y=function(t){return t?(n._vy=t,n):n._vy},n.polygons=function(t){if(t!==void 0&&n(t),!n.delaunay)return!1;const i={type:"FeatureCollection",features:[]};return n.valid.length===0||(n.delaunay.polygons.forEach((r,o)=>i.features.push({type:"Feature",geometry:r?{type:"Polygon",coordinates:[[...r,r[0]].map(l=>n.delaunay.centers[l])]}:null,properties:{site:n.valid[o],sitecoordinates:n.points[o],neighbours:n.delaunay.neighbors[o]}})),n.valid.length===1&&i.features.push({type:"Feature",geometry:{type:"Sphere"},properties:{site:n.valid[0],sitecoordinates:n.points[0],neighbours:[]}})),i},n.triangles=function(t){return t!==void 0&&n(t),n.delaunay?{type:"FeatureCollection",features:n.delaunay.triangles.map((i,r)=>(i=i.map(o=>n.points[o]),i.center=n.delaunay.centers[r],i)).filter(i=>Yt(i)>0).map(i=>({type:"Feature",properties:{circumcenter:i.center},geometry:{type:"Polygon",coordinates:[[...i,i[0]]]}}))}:!1},n.links=function(t){if(t!==void 0&&n(t),!n.delaunay)return!1;const i=n.delaunay.edges.map(o=>de(n.points[o[0]],n.points[o[1]])),r=n.delaunay.urquhart(i);return{type:"FeatureCollection",features:n.delaunay.edges.map((o,l)=>({type:"Feature",properties:{source:n.valid[o[0]],target:n.valid[o[1]],length:i[l],urquhart:!!r[l]},geometry:{type:"LineString",coordinates:[n.points[o[0]],n.points[o[1]]]}}))}},n.mesh=function(t){return t!==void 0&&n(t),n.delaunay?{type:"MultiLineString",coordinates:n.delaunay.edges.map(i=>[n.points[i[0]],n.points[i[1]]])}:!1},n.cellMesh=function(t){if(t!==void 0&&n(t),!n.delaunay)return!1;const{centers:i,polygons:r}=n.delaunay,o=[];for(const l of r)if(l)for(let s=l.length,a=l[s-1],f=l[0],c=0;c<s;a=f,f=l[++c])f>a&&o.push([i[a],i[f]]);return{type:"MultiLineString",coordinates:o}},n._found=void 0,n.find=function(t,i,r){if(n._found=n.delaunay.find(t,i,n._found),!r||de([t,i],n.points[n._found])<r)return n._found},n.hull=function(t){t!==void 0&&n(t);const i=n.delaunay.hull,r=n.points;return i.length===0?null:{type:"Polygon",coordinates:[[...i.map(o=>r[o]),r[i[0]]]]}},e?n(e):n}function Br(e){try{const{data:n}=e.success,{features:t}=De(n,n.objects.output);return t}catch(n){return console.error(n),[]}}function Or(e){const{features:n,onClick:t,color:i="rgba(150,150,150, 1)",singleFeature:r=!0}=e,o=ci(i);return H(Tn,{className:"columns",useCanvas:t==null,style:{fill:o.alpha(.2).css(),stroke:o.alpha(.4).css()}},n.map(l=>H(ii,{id:l.id??l.properties.col_id,onClick:t,feature:l})))}function Ie(e){return e>Math.PI?e-=2*Math.PI:e<=-Math.PI&&(e+=2*Math.PI),e}function Ur(e){console.log("Computing triangulation");const n=e.map(je),t=Yr(n);return{centroids:n,tri:t}}function Zr(e,n,t,i){if(e==null)return;const r=i(n[t]);let o=e.map(s=>{const a=i(n[s]),f=a[0]-r[0],c=a[1]-r[1];return{col_index:s,angle:Math.atan2(c,f)}});o.sort(s=>s.angle);function l(s){let a=o[0];for(let f of o)Math.abs(Ie(s-f.angle))<Math.abs(Ie(s-a.angle))&&(a=f);return a.col_index}return{37:l(Math.PI),38:l(3*Math.PI/2),39:l(0),40:l(Math.PI/2)}}function Wr(e){const{features:n=[],col_id:t=null,onChange:i,showLayers:r=!1,...o}=e,{projection:l}=sn.useContext(ri),{centroids:s,tri:a}=sn.useMemo(()=>Ur(n),[n]),f=sn.useMemo(()=>n.findIndex(p=>p.properties.col_id==t),[n,t]),c=a.delaunay.neighbors[f],u=sn.useMemo(()=>Zr(c,s,f,l),[c,f]);if(hi(p=>{const g=u[p.keyCode];if(g==null)return;const{col_id:d}=n[g].properties;i({col_id:d,...o})},[u]),c==null)return null;const h=c.map(p=>n[p]);return H.if(r)([H(Tn,{features:a.links().features,useCanvas:!1,style:{stroke:"purple",fill:"transparent"}}),H(Tn,{features:h,useCanvas:!1,style:{stroke:"rgb(93, 101, 212)",strokeWidth:3,fill:"rgba(93, 101, 212, 0.5)"}})])}function Vr(e){var n;return Je((n=e==null?void 0:e.success)==null?void 0:n.data)}function Je(e){return e==null?void 0:e.features}const Jr={topojson:Br,geojson:Vr,geojson_bare:Je};function Qr({apiRoute:e="/columns",status_code:n,project_id:t,format:i="topojson"}){let r;n==null&&t==null&&(r=!0);const o=Jr[i];return li(e,{format:i,all:r,status_code:n,project_id:t},o)}const no=e=>{const{apiRoute:n="/columns",onChange:t,col_id:i=null,status_code:r,project_id:o,color:l,filterColumns:s,showDebugLayers:a=!1,format:f="topojson"}=e;let c=Qr({apiRoute:n,status_code:r,project_id:o,format:f});return c==null?null:(s!=null&&(c=c.filter(s)),H([H(Wr,{features:c,col_id:i,onChange:t,status_code:r,project_id:o,showLayers:a}),H(Or,{features:c,onClick:t,color:l})]))},to=e=>{const{feature:n}=e;return H(Tn,{features:[n],style:{fill:"rgba(255,0,0,0.4)",stroke:"rgba(255,0,0,0.6)",strokeWidth:2}})};function eo(e){const{center:n,children:t,style:i,margin:r,className:o,allowZoom:l,...s}=e;let{scale:a}=e;const f=sn.useRef(null),c=ui(f),{width:u,height:h}=c??{width:0,height:0};a==null&&(a=Math.min(u,h)+2*r);let p=null;return l&&(p=[.1*Math.min(u,h),2*Math.max(u,h)]),H("div.map-area",{ref:f,style:i,className:o},[H(oi,{width:u,height:h,margin:r,center:n,allowDrag:!0,allowZoom:l,keepNorthUp:!0,zoomScaleExtent:p,...s,scale:a},[H(Ei),t])])}const Qe=e=>{const{currentColumn:n,setCurrentColumn:t,children:i,style:r,margin:o=10,scale:l,className:s,...a}=e,f=je(n);return H(eo,{center:f,style:r,margin:o,scale:l,className:s},[i,H(no,{onChange:t,col_id:n==null?void 0:n.properties.col_id,...a}),H.if(n!=null)(to,{feature:n})])};function io({children:e,useDev:n=!0,baseURL:t}){return t??(t=n?"https://dev.macrostrat.org/api/v2":"https://macrostrat.org/api/v2"),H(si,{baseURL:t,unwrapResponse:i=>i.success.data},e)}const Yo={title:"Column views/Index map",component:Qe};function Kn(e){return H(io,[H("div",{style:{width:300,height:300}},H(Qe))])}var Ce,Ae,Ne;Kn.parameters={...Kn.parameters,docs:{...(Ce=Kn.parameters)==null?void 0:Ce.docs,source:{originalSource:`function BasicColumnNavigatorMap(props: ColumnIndexMapProps) {
  return h(MacrostratAPIProvider, [h("div", {
    style: {
      width: 300,
      height: 300
    }
  }, h(ColumnNavigatorMap))]);
}`,...(Ne=(Ae=Kn.parameters)==null?void 0:Ae.docs)==null?void 0:Ne.source}}};const Bo=["BasicColumnNavigatorMap"];export{Kn as BasicColumnNavigatorMap,Bo as __namedExportsOrder,Yo as default};
